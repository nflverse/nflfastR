<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Update or Create a nflverse Play-by-Play Data Table in a Connected Database — update_pbp_db • nflfastR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Kanit-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Update or Create a nflverse Play-by-Play Data Table in a Connected Database — update_pbp_db"><meta name="description" content="The nflfastR play-by-play era dates back to 1999. To analyze all the data
efficiently, there is practically no alternative to working with a database.
This function helps to create and maintain a table containing all
play-by-play data of the nflfastR era in a connected database.
Primarily, the preprocessed data from load_pbp is written to the database
and, if necessary, supplemented with the latest games using
build_nflfastR_pbp."><meta property="og:description" content="The nflfastR play-by-play era dates back to 1999. To analyze all the data
efficiently, there is practically no alternative to working with a database.
This function helps to create and maintain a table containing all
play-by-play data of the nflfastR era in a connected database.
Primarily, the preprocessed data from load_pbp is written to the database
and, if necessary, supplemented with the latest games using
build_nflfastR_pbp."><meta property="og:image" content="https://nflfastr.com/reference/figures/card.png"><meta property="og:image:alt" content="nflfastR social preview card"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@nflfastR"><meta name="twitter:site" content="@nflfastR"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nflfastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">5.2.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/nflfastR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/beginners_guide.html">A beginner’s guide to nflfastR</a></li>
    <li><a class="dropdown-item" href="../articles/field_descriptions.html">Field Descriptions</a></li>
    <li><a class="dropdown-item" href="../articles/stats_variables.html">Stats Variable Descriptions</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/">nflfastR models</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com/">Open Source Football</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://rbsdm.com/stats/" aria-label="Stats"><span class="fa fas fa-chart-line fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="http://nflgamedata.com/" aria-label="Games"><span class="fa fas fa-football-ball fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discord.com/invite/5Er2FBnnQa" aria-label="Discord"><span class="fa fab fa-discord fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nflverse/nflfastR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages &amp; More</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages-more"><li><h6 class="dropdown-header" data-toc-skip>nflverse Packages</h6></li>
    <li><a class="dropdown-item" href="https://nflfastr.com">nflfastR</a></li>
    <li><a class="external-link dropdown-item" href="https://nflseedr.com">nflseedR</a></li>
    <li><a class="external-link dropdown-item" href="https://www.nfl4th.com">nfl4th</a></li>
    <li><a class="external-link dropdown-item" href="https://nflreadr.nflverse.com/">nflreadr</a></li>
    <li><a class="external-link dropdown-item" href="https://nflplotr.nflverse.com/">nflplotR</a></li>
    <li><a class="external-link dropdown-item" href="https://nflverse.nflverse.com/">nflverse</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com">Open Source Football</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>nflverse Data</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nflverse">nflverse GitHub</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>ffverse</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.ffverse.com">ffverse.com</a></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Update or Create a nflverse Play-by-Play Data Table in a Connected Database</h1>
      <small class="dont-index">Source: <a href="https://github.com/nflverse/nflfastR/blob/master/R/database.R" class="external-link"><code>R/database.R</code></a></small>
      <div class="d-none name"><code>update_pbp_db.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The nflfastR play-by-play era dates back to 1999. To analyze all the data
efficiently, there is practically no alternative to working with a database.</p>
<p>This function helps to create and maintain a table containing all
play-by-play data of the nflfastR era in a connected database.
Primarily, the preprocessed data from <a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp</a> is written to the database
and, if necessary, supplemented with the latest games using
<a href="build_nflfastR_pbp.html">build_nflfastR_pbp</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">update_pbp_db</span><span class="op">(</span><span class="va">conn</span>, <span class="va">...</span>, name <span class="op">=</span> <span class="st">"nflverse_pbp"</span>, seasons <span class="op">=</span> <span class="fu"><a href="https://nflreadr.nflverse.com/reference/latest_season.html" class="external-link">most_recent_season</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-conn">conn<a class="anchor" aria-label="anchor" href="#arg-conn"></a></dt>
<dd><p>A <code>DBIConnection</code> object, as returned by <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect()</a></code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>These dots are for future extensions and must be empty.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The table name, passed on to <code><a href="https://dbi.r-dbi.org/reference/dbQuoteIdentifier.html" class="external-link">dbQuoteIdentifier()</a></code>. Options are:</p><ul><li><p>a character string with the unquoted DBMS table name,
e.g. <code>"table_name"</code>,</p></li>
<li><p>a call to <code><a href="https://dbi.r-dbi.org/reference/Id.html" class="external-link">Id()</a></code> with components to the fully qualified table name,
e.g. <code>Id(schema = "my_schema", table = "table_name")</code></p></li>
<li><p>a call to <code><a href="https://dbi.r-dbi.org/reference/SQL.html" class="external-link">SQL()</a></code> with the quoted and fully qualified table name
given verbatim, e.g. <code>SQL('"my_schema"."table_name"')</code></p></li>
</ul></dd>


<dt id="arg-seasons">seasons<a class="anchor" aria-label="anchor" href="#arg-seasons"></a></dt>
<dd><p>Hybrid argument (logical or numeric) to update parts
of or the complete play by play table within the database.</p>
<p>It can update the play by play data table either for the whole nflfastR era
(with <code>seasons = TRUE</code>) or just for specified seasons
(e.g. <code>seasons = 2024:2025</code>).</p>
<p>Defaults to <a href="https://nflreadr.nflverse.com/reference/latest_season.html" class="external-link">most_recent_season</a>. Please see details for further information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Always returns the database connection invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="the-seasons-argument">The <code>seasons</code> argument<a class="anchor" aria-label="anchor" href="#the-seasons-argument"></a></h3>


<p>The <code>seasons</code> argument controls how the table in the connected database is
handled.</p>
<p>With <code>seasons = TRUE</code>, the table in argument <code>name</code> will be removed completely
(by calling <a href="https://dbi.r-dbi.org/reference/dbRemoveTable.html" class="external-link">DBI::dbRemoveTable</a>) and all seasons of the nflfastR era will be
added to a fresh table. This is helpful when new columns are added during the
offseason.</p>
<p>With a numerical vector, e.g. <code>seasons = 2024:2025</code>, the table in argument
<code>name</code> will be preserved and only rows from the given seasons will be deleted
and re-added (by calling <a href="https://dbi.r-dbi.org/reference/dbAppendTable.html" class="external-link">DBI::dbAppendTable</a>). This is intended to be used
for ongoing seasons because the NFL fixes bugs in the underlying data during
the week and we recommend rebuilding the current season every Thursday during
the season.</p>
<p>The default behavior is <code>seasons = most_recent_season()</code>, which means that
only the most recent season is updated or added.</p>
<p>To keep the table, and thus also the schema, but update all play-by-play
data of the nflfastR era, set</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>seasons <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1999</span>, <span class="fu">most_recent_season</span>())</span></code></pre><p></p></div>
<p>If <code>seasons</code> contains multiple seasons, it is possible to control whether the
seasons are loaded individually and written to the database, or whether
multiple seasons should be processed in chunks. The latter is more efficient
because fewer write operations are required, but at the same time, the data
must first be stored in memory. The option <code>“nflfastR.db_chunk_size”</code> can
be used to control how many seasons are loaded together in a chunk and
written to the database. With the following option, for example, 5 seasons
are always loaded together and written to the database.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"nflfastR.db_chunk_size"</span> <span class="ot">=</span> <span class="dv">5</span><span class="dt">L</span>)</span></code></pre><p></p></div>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span><span class="co"># to avoid CRAN test problems</span></span></span>
<span class="r-in"><span><span class="fu">update_pbp_db</span><span class="op">(</span><span class="va">con</span>, seasons <span class="op">=</span> <span class="fl">2024</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Update nflverse Play-by-Play Data in Connected Database</span> ─────────────────────</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Table <span style="color: #0000BB;">"nflverse_pbp"</span> does not yet exist in your connected database.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Do you wish to create it? (Y/n)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 11:48:05 | Initiate table <span style="color: #0000BB;">"nflverse_pbp"</span> with nflverse pbp schema</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 11:48:05 | Drop <span style="color: #0000BB;">2024</span> season from table <span style="color: #0000BB;">"nflverse_pbp"</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 11:48:05 | Append <span style="color: #0000BB;">2024</span> season to table <span style="color: #0000BB;">"nflverse_pbp"</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 11:48:08 | Database update completed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">DONE</span> ────────────────────────────────────────────────────────────────────────</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mrcaseb.com" class="external-link">Sebastian Carl</a>, <a href="https://bsky.app/profile/rbsdm.com" class="external-link">Ben Baldwin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

