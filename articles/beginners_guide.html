<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A beginner's guide to nflfastR • nflfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Kanit-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="A beginner's guide to nflfastR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nflfastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">5.2.0.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/nflfastR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/beginners_guide.html">A beginner’s guide to nflfastR</a></li>
    <li><a class="dropdown-item" href="../articles/field_descriptions.html">Field Descriptions</a></li>
    <li><a class="dropdown-item" href="../articles/stats_variables.html">Stats Variable Descriptions</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/">nflfastR models</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com/">Open Source Football</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://rbsdm.com/stats/" aria-label="Stats"><span class="fa fas fa-chart-line fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="http://nflgamedata.com/" aria-label="Games"><span class="fa fas fa-football-ball fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discord.com/invite/5Er2FBnnQa" aria-label="Discord"><span class="fa fab fa-discord fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nflverse/nflfastR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages &amp; More</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages-more">
<li><h6 class="dropdown-header" data-toc-skip>nflverse Packages</h6></li>
    <li><a class="dropdown-item" href="https://nflfastr.com">nflfastR</a></li>
    <li><a class="external-link dropdown-item" href="https://nflseedr.com">nflseedR</a></li>
    <li><a class="external-link dropdown-item" href="https://www.nfl4th.com">nfl4th</a></li>
    <li><a class="external-link dropdown-item" href="https://nflreadr.nflverse.com/">nflreadr</a></li>
    <li><a class="external-link dropdown-item" href="https://nflplotr.nflverse.com/">nflplotR</a></li>
    <li><a class="external-link dropdown-item" href="https://nflverse.nflverse.com/">nflverse</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com">Open Source Football</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>nflverse Data</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nflverse">nflverse GitHub</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>ffverse</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.ffverse.com">ffverse.com</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A beginner's guide to nflfastR</h1>
                        <h4 data-toc-skip class="author">Ben
Baldwin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nflverse/nflfastR/blob/master/vignettes/beginners_guide.Rmd" class="external-link"><code>vignettes/beginners_guide.Rmd</code></a></small>
      <div class="d-none name"><code>beginners_guide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The following guide will assume you have R installed. I also highly
recommend working in RStudio. If you need help getting those installed
or are unfamiliar with how RStudio is laid out, <a href="https://github.com/leesharpe/nfldata/blob/master/RSTUDIO-INTRO.md#r-and-rstudio-introduction" class="external-link">please
see this section of Lee Sharpe’s guide</a>.</p>
<p>A quick word if you’re new to programming: all of this is happening
in R. Obviously, you need to install R on your computer to do any of
this. Make sure you save what you’re doing in a script (in RStudio, File
–&gt; New File –&gt; R script) so you can save your work and run
multiple lines of code at once. To run code from a script, highlight
what you want, and press control + enter or press the Run button in the
top of the editor (see Lee’s guide). If you don’t highlight anything and
press control + enter, the currently selected line will run. As you go
through your R journey, you might get stuck and have to google a bunch
of things, but that’s totally okay and normal. That’s how I got
started!</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, you need to install the magic packages. You only need to run
this step once on a given computer. For these you can just type them
into the RStudio console (look for the Console pane in RStudio) directly
since you’re never going to be doing this again.</p>
<div class="section level3">
<h3 id="install-packages">Install packages<a class="anchor" aria-label="anchor" href="#install-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggrepel"</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nflreadr"</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nflplotR"</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<p>Okay, now here’s the stuff you’re going to want to start putting into
your R script. The following loads <code>tidyverse</code>, which
contains a lot of helper functions for working with data and
<code>ggrepel</code> for making figures, along with
<code>nflreadr</code> (which allows one to quickly download
<code>nflfastR</code> data, along with a lot of other data). Finally,
<code>nflplotR</code> makes plotting easier.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nflreadr.nflverse.com" class="external-link">nflreadr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nflplotr.nflverse.com" class="external-link">nflplotR</a></span><span class="op">)</span></span></code></pre></div>
<p>This one is optional but makes R prefer not to display numbers in
scientific notation, which I find very annoying:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>This will load the full play by play for the 2019 season (including
playoffs). We’ll get to how to get more seasons later. Note that this is
downloading pre-cleaned data from the nflfastR data repository using the
<code><a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp()</a></code> function included in <code>nflreadr</code>,
which is much faster than building pbp from scratch.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="basics-how-to-look-at-your-data">Basics: how to look at your data<a class="anchor" aria-label="anchor" href="#basics-how-to-look-at-your-data"></a>
</h2>
<div class="section level3">
<h3 id="dimensions">Dimensions<a class="anchor" aria-label="anchor" href="#dimensions"></a>
</h3>
<p>Before moving forward, here are a few ways to get a sense of what’s
in a dataframe. We can check the <strong>dim</strong>ensions of the
data, and this tells us that there are <code>47260</code> rows (i.e.,
plays) in the data and <code>372</code> columns (variables):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 47260   372</span></span></code></pre></div>
<p><code>str</code> displays the <strong>str</strong>ucture of the
dataframe:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; nflvrs_d [47,260 × 10] (S3: nflverse_data/tbl_df/tbl/data.table/data.frame)</span></span>
<span><span class="co">#&gt;  $ play_id     : num [1:47260] 1 36 51 79 100 121 148 185 214 239 ...</span></span>
<span><span class="co">#&gt;  $ game_id     : chr [1:47260] "2019_01_ATL_MIN" "2019_01_ATL_MIN" "2019_01_ATL_MIN" "2019_01_ATL_MIN" ...</span></span>
<span><span class="co">#&gt;  $ old_game_id : chr [1:47260] "2019090804" "2019090804" "2019090804" "2019090804" ...</span></span>
<span><span class="co">#&gt;  $ home_team   : chr [1:47260] "MIN" "MIN" "MIN" "MIN" ...</span></span>
<span><span class="co">#&gt;  $ away_team   : chr [1:47260] "ATL" "ATL" "ATL" "ATL" ...</span></span>
<span><span class="co">#&gt;  $ season_type : chr [1:47260] "REG" "REG" "REG" "REG" ...</span></span>
<span><span class="co">#&gt;  $ week        : int [1:47260] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ posteam     : chr [1:47260] NA "ATL" "ATL" "ATL" ...</span></span>
<span><span class="co">#&gt;  $ posteam_type: chr [1:47260] NA "away" "away" "away" ...</span></span>
<span><span class="co">#&gt;  $ defteam     : chr [1:47260] NA "MIN" "MIN" "MIN" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "nflverse_timestamp")= chr "2025-07-31 14:16:40 EDT"</span></span>
<span><span class="co">#&gt;  - attr(*, "nflverse_type")= chr "play by play data"</span></span>
<span><span class="co">#&gt;  - attr(*, "nflfastR_version")= chr "5.1.0.9001"</span></span></code></pre></div>
<p>In the above, I’ve added in the <code>[1:10]</code>, which selects
only the first 10 columns, otherwise the list is extremely long
(remember from above that there are <code>372</code> columns!).
Normally, you would just type <code>str(data)</code>.</p>
<p>You can similarly take a glimpse at your data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 47,260</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; $ play_id      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>36<span style="color: #949494;">, </span>51<span style="color: #949494;">, </span>79<span style="color: #949494;">, </span>100<span style="color: #949494;">, </span>121<span style="color: #949494;">, </span>148<span style="color: #949494;">, </span>185<span style="color: #949494;">, </span>214<span style="color: #949494;">, </span>239<span style="color: #949494;">, </span>255<span style="color: #949494;">, </span>277<span style="color: #949494;">, </span>29…</span></span>
<span><span class="co">#&gt; $ game_id      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2019_01_ATL_MIN"<span style="color: #949494;">, </span>"2019_01_ATL_MIN"<span style="color: #949494;">, </span>"2019_01_ATL_MIN"<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ old_game_id  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2019090804"<span style="color: #949494;">, </span>"2019090804"<span style="color: #949494;">, </span>"2019090804"<span style="color: #949494;">, </span>"2019090804"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ home_team    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ away_team    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ season_type  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"REG"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ week         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ posteam      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN…</span></span>
<span><span class="co">#&gt; $ posteam_type <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>"away"<span style="color: #949494;">, </span>"away"<span style="color: #949494;">, </span>"away"<span style="color: #949494;">, </span>"away"<span style="color: #949494;">, </span>"away"<span style="color: #949494;">, </span>"home"<span style="color: #949494;">, </span>"home…</span></span>
<span><span class="co">#&gt; $ defteam      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"MIN"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL"<span style="color: #949494;">, </span>"ATL…</span></span></code></pre></div>
<p>Where again I’m only showing the first 10 columns. The usual command
would be <code>glimpse(data)</code>.</p>
</div>
<div class="section level3">
<h3 id="variable-names">Variable names<a class="anchor" aria-label="anchor" href="#variable-names"></a>
</h3>
<p>Another very useful command is to get the <code>names</code> of the
variables in the data, which you would get by entering
<code>names(data)</code> (I won’t show here because, again, it is
<code>372</code> columns).</p>
<p>That is a lot to work with!</p>
</div>
<div class="section level3">
<h3 id="viewer">Viewer<a class="anchor" aria-label="anchor" href="#viewer"></a>
</h3>
<p>One more way to look at your data is with the <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>
function. If you’re coming from an Excel background, this will help you
feel more at home as a way to see what’s in the data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>This will open the viewer in RStudio in a new panel. Try it out
yourself! Since there are so many columns, the Viewer won’t show them
all. To pick which columns to view, you can <strong>select</strong>
some:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">home_team</span>, <span class="va">away_team</span>, <span class="va">posteam</span>, <span class="va">desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>|&gt;</code> thing lets you pipe together a bunch of
different commands. So we’re taking our data, “<code>select</code>”ing a
few variables we want to look at, and then Viewing. Again, I can’t
display the results of that here, but try it out yourself!</p>
</div>
<div class="section level3">
<h3 id="head-manipulation">Head + manipulation<a class="anchor" aria-label="anchor" href="#head-manipulation"></a>
</h3>
<p>To start, let’s just look at the first few rows (the “head”) of the
data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">defteam</span>, <span class="va">desc</span>, <span class="va">rush</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   posteam defteam desc                                                rush  pass</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      GAME                                                   0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ATL     MIN     5-D.Bailey kicks 65 yards from MIN 35 to end zone…     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ATL     MIN     (15:00) 2-M.Ryan sacked at ATL 17 for -8 yards (5…     0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ATL     MIN     (14:20) 24-D.Freeman right tackle to ATL 21 for 4…     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ATL     MIN     (13:41) (Shotgun) 2-M.Ryan scrambles left end to …     0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ATL     MIN     (12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson…     0     0</span></span></code></pre></div>
<p>A couple things. “<code>desc</code>” is the important variable that
lists the description of what happened on the play, and
<code>head</code> says to show the first few rows (the “head” of the
data). Since this is already sorted by game, these are the first 6 rows
from a week 1 game, ATL @ MIN. To make code easier to read, people often
put each part of a pipe on a new line, which is useful when working with
more complicated functions. We could run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">defteam</span>, <span class="va">desc</span>, <span class="va">rush</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And it would return the exact same output as the one written out in
multiple lines, but the code isn’t as easy to read.</p>
<p>We’ve covered <code>select</code>, and the next important function to
learn is <code>filter</code>, which lets you filter the data to what you
want. The following returns only plays that are run plays and pass
plays; i.e., no punts, kickoffs, field goals, or dead ball penalties
(e.g. false starts) where we don’t know what the attempted play was.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">desc</span>, <span class="va">rush</span>, <span class="va">pass</span>, <span class="va">name</span>, <span class="va">passer</span>, <span class="va">rusher</span>, <span class="va">receiver</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   posteam desc                           rush  pass name  passer rusher receiver</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ATL     (15:00) 2-M.Ryan sacked at A…     0     1 M.Ry… M.Ryan <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ATL     (14:20) 24-D.Freeman right t…     1     0 D.Fr… <span style="color: #BB0000;">NA</span>     D.Fre… <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ATL     (13:41) (Shotgun) 2-M.Ryan s…     0     1 M.Ry… M.Ryan <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> MIN     (12:53) 33-D.Cook right end …     1     0 D.Co… <span style="color: #BB0000;">NA</span>     D.Cook <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> MIN     (12:32) 8-K.Cousins pass sho…     0     1 K.Co… K.Cou… <span style="color: #BB0000;">NA</span>     D.Cook  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> MIN     (11:57) 8-K.Cousins pass sho…     0     1 K.Co… K.Cou… <span style="color: #BB0000;">NA</span>     A.Thiel…</span></span></code></pre></div>
<p>Compared to the first time we did this, the opening line for the
start of the game, the kickoff, and the punt are now gone. Note that if
you’re checking whether a variable is equal to something, we need to use
the double equals sign <code>==</code> like above. There’s probably some
technical reason for this [shrug emoji]. Also, the character
<code>|</code> is used for “or”, and <code>&amp;</code> for “and”. So
<code>rush == 1 | pass == 1</code> means “rush or pass”.</p>
<p>Note that the <code>rush</code>, <code>pass</code>,
<code>name</code>, <code>passer</code>, <code>rusher</code>, and
<code>receiver</code> columns are all <code>nflfastR</code> creations,
where we have provided these to make working with the data easier. As we
can see above, <code>passer</code> is filled in for all dropbacks
(including sacks and scrambles, which also have <code>pass</code> = 1),
and <code>name</code> is equal to the passer on pass plays and the
rusher on rush plays. Think of this as the primary player involved on a
play.</p>
<p>What if we wanted to view special teams plays? Again, we can use
<code>filter</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">special</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">down</span>, <span class="va">ydstogo</span>, <span class="va">desc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    down ydstogo desc                                                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    <span style="color: #BB0000;">NA</span>       0 5-D.Bailey kicks 65 yards from MIN 35 to end zone, Touchback.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     4       2 (12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson, Center-47-J.…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    <span style="color: #BB0000;">NA</span>       0 (Kick formation) 5-D.Bailey extra point is GOOD, Center-58-A.Cu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    <span style="color: #BB0000;">NA</span>       0 5-D.Bailey kicks 67 yards from MIN 35 to ATL -2. 38-K.Barner to…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    <span style="color: #BB0000;">NA</span>       0 (Kick formation) 5-D.Bailey extra point is GOOD, Center-58-A.Cu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    <span style="color: #BB0000;">NA</span>       0 5-D.Bailey kicks 65 yards from MIN 35 to end zone, Touchback.</span></span></code></pre></div>
<p>Fourth down plays?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">down</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">down</span>, <span class="va">ydstogo</span>, <span class="va">desc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    down ydstogo desc                                                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     4       2 (12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson, Center-47-J.…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     4      19 (2:38) 5-M.Bosher punts 33 yards to MIN 8, Center-47-J.Harris, …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     4      20 (12:33) 2-B.Colquitt punts 51 yards to ATL 17, Center-58-A.Cutt…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4      27 (1:49) 5-M.Bosher punts 45 yards to MIN 10, Center-47-J.Harris,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     4      10 (:49) 2-B.Colquitt punts 57 yards to ATL 33, Center-58-A.Cuttin…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     4       1 (10:56) 2-B.Colquitt punts 42 yards to ATL 10, Center-58-A.Cutt…</span></span></code></pre></div>
<p>Fourth down plays that aren’t special teams plays?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">down</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">special</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">down</span>, <span class="va">ydstogo</span>, <span class="va">desc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    down ydstogo desc                                                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     4       5 (9:25) (Shotgun) 2-M.Ryan pass deep left to 18-C.Ridley for 20 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     4       2 (4:39) (Punt formation) PENALTY on MIN, Delay of Game, 5 yards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     4       2 (1:27) (No Huddle, Shotgun) 2-M.Ryan pass short left to 11-J.Jo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4       1 (2:59) (Punt formation) Direct snap to 41-A.Levine. 41-A.Levine…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     4       3 (9:30) (Shotgun) 3-R.Griffin pass short left to 89-M.Andrews fo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     4       1 (3:55) 17-J.Allen FUMBLES (Aborted) at NYJ 37, RECOVERED by NYJ…</span></span></code></pre></div>
<p>So far, we’ve just been taking a look at the initial dataset we
downloaded, but none of our results are preserved. To save a new
dataframe of just the plays we want, we need to use <code>&lt;-</code>
to assign a new dataframe. Let’s save a new dataframe that’s just run
plays and pass plays with non-missing EPA, called
<code>pbp_rp</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the above, <code>!is.na(epa)</code> means to exclude plays with
missing (<code>na</code>) EPA. The <code>!</code> symbol is often used
by computer folk to negate something, so <code>is.na(epa)</code> means
“EPA is missing” and <code>!is.na(epa)</code> means “EPA is not
missing”, which we have used above.</p>
</div>
</div>
<div class="section level2">
<h2 id="some-basic-stuff-part-1">Some basic stuff: Part 1<a class="anchor" aria-label="anchor" href="#some-basic-stuff-part-1"></a>
</h2>
<p>Okay, we have a big dataset where we call dropbacks pass plays and
non-dropbacks rush plays. Now we actually want to, like, do stuff.</p>
<div class="section level3">
<h3 id="group-by-and-summarize">Group by and Summarize<a class="anchor" aria-label="anchor" href="#group-by-and-summarize"></a>
</h3>
<p>Let’s take a look at how various Cowboys’ running backs fared on run
plays in 2019:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"DAL"</span>, <span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>      mean_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span>, success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span>, ypc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yards_gained</span><span class="op">)</span>, plays <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">mean_epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plays</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   rusher     mean_epa success_rate   ypc plays</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> D.Prescott   0.288         0.591  6.41    22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> T.Pollard   -<span style="color: #BB0000;">0.026</span><span style="color: #BB0000; text-decoration: underline;">5</span>        0.456  5.08    90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> E.Elliott   -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">2</span>        0.411  4.39   309</span></span></code></pre></div>
<p>There’s a lot going on here. We’ve covered <code>filter</code>
already. The <code>group_by</code> function is an <em>extremely</em>
useful function that, well, groups by what you tell it – in this case
the rusher. Summarize is useful for collapsing the data down to a
summary of what you’re looking at, and here, while grouping by player,
we’re summarizing the mean of EPA, success, yardage (a bad rushing stat,
but since we’re here), and getting the number of plays using
<code><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n()</a></code>, which returns the number in a group. Unsurprisingly,
Prescott was much more effective as a rusher in 2019 than the running
backs, and there was no meaningful difference between Pollard and
Elliott in efficiency.</p>
<p>If you check the <a href="https://www.pro-football-reference.com/teams/dal/2019.htm" class="external-link">PFR
team stats page</a>, you’ll notice that the above doesn’t match up with
the official stats. This is because <code>nflfastR</code> computes EPA
and provides player names on plays with penalties and on two-point
conversions. So if wanting to match the official stats, we need to
restrict to <code>down &lt;= 4</code> (to excluded two-point
conversions, which have down listed as <code>NA</code>) and
<code>play_type = run</code> (to exclude penalties, which are
<code>play_type = no_play</code>):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"DAL"</span>, <span class="va">down</span> <span class="op">&lt;=</span> <span class="fl">4</span>, <span class="va">play_type</span> <span class="op">==</span> <span class="st">'run'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>      mean_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span>, success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span>, ypc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yards_gained</span><span class="op">)</span>, plays<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plays</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   rusher     mean_epa success_rate   ypc plays</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> D.Prescott   0.288         0.591  6.41    22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> E.Elliott   -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">5</span>        0.422  4.51   301</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> T.Pollard   -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">0</span>        0.453  5.29    86</span></span></code></pre></div>
<p>Now we exactly match PFR: Zeke has 301 carries at 4.5 yards/carry,
and Pollard has 86 carries for 5.3 yards/carry. Note that we still
aren’t matching Dak’s stats to PFR because the NFL classifies scrambles
as rush attempts and <code>nflfastR</code> does not.</p>
</div>
<div class="section level3">
<h3 id="manipulating-columns-mutate-if_else-and-case_when">Manipulating columns: mutate, if_else, and case_when<a class="anchor" aria-label="anchor" href="#manipulating-columns-mutate-if_else-and-case_when"></a>
</h3>
<p>Let’s say we want to make a new column, named <code>home</code>,
which is equal to 1 if the team with the ball is the home team. Let’s
introduce another extremely useful function, <code>if_else</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    home <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="va">home_team</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">home_team</span>, <span class="va">home</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-07-31 18:16:40 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;    posteam home_team  home</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> MIN     MIN           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> MIN     MIN           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> MIN     MIN           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ATL     MIN           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> MIN     MIN           1</span></span></code></pre></div>
<p><code>mutate</code> is R’s word for creating a new column (or
overwriting an existing one); in this case, we’ve created a new column
called <code>home</code>. The above uses <code>if_else</code>, which
uses the following pattern: condition (in this case,
<code>posteam == home_team</code>), value if condition is true (in this
case, if <code>posteam == home_team</code>, it is 1), and value if the
condition is false (0). So we could use this to, for example, look at
average EPA/play by home and road teams:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    home <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="va">home_team</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">home</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;    home     epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0  0.021<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">4</span></span></span></code></pre></div>
<p>Note that EPA/play is similar for home teams and away teams because
<code>home</code> is already built into the <code>nflfastR</code> EPA
model, so this result is expected. Actually, away EPA/play is actually
somewhat higher, presumably because away teams out-performed their usual
in 2019 as homefield advantage continues to decline generally.</p>
<p><code>if_else</code> is nice if you’re creating a new column based on
a simple condition. But what if you need to do something more
complicated? <code>case_when</code> is a good option. Here’s how it
works:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    depth <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"Negative"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"Short"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"Medium"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"Deep"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   depth       cp</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Deep     0.367</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Medium   0.573</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Negative 0.847</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Short    0.718</span></span></code></pre></div>
<p>Note the new syntax for <code>case_when</code>: we have condition
(for the first one, air yards less than 0), followed by <code>~</code>,
followed by assignment (for the first one, “Negative”). In the above, we
created 4 bins based on air yards and got average completion probability
(<code>cp</code>) based on the <code>nflfastR</code> model.
Unsurprisingly, <code>cp</code> is lower the longer downfield a throw
goes.</p>
</div>
<div class="section level3">
<h3 id="a-basic-figure">A basic figure<a class="anchor" aria-label="anchor" href="#a-basic-figure"></a>
</h3>
<p>Now that we’ve gained some skills at manipulating data, let’s put it
to use by making things. Which teams were the most pass-heavy in the
first half on early downs with win probability between 20 and 80,
excluding the final 2 minutes of the half when everyone is
pass-happy?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schotty</span> <span class="op">&lt;-</span> <span class="va">pbp_rp</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wp</span> <span class="op">&gt;</span> <span class="fl">.20</span> <span class="op">&amp;</span> <span class="va">wp</span> <span class="op">&lt;</span> <span class="fl">.80</span> <span class="op">&amp;</span> <span class="va">down</span> <span class="op">&lt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">qtr</span> <span class="op">&lt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">half_seconds_remaining</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_pass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pass</span><span class="op">)</span>, plays <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">mean_pass</span><span class="op">)</span></span>
<span><span class="va">schotty</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 3</span></span></span>
<span><span class="co">#&gt;    posteam mean_pass plays</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> KC          0.688   388</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> MIA         0.594   288</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> NO          0.585   325</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> LA          0.584   329</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CHI         0.558   310</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CLE         0.555   272</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CAR         0.554   271</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> TB          0.551   321</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> GB          0.550   291</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ARI         0.548   325</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre></div>
<p>Again, we’ve already used <code>filter</code>, <code>group_by</code>,
and <code>summarize</code>. The new function we are using here is
<code>arrange</code>, which sorts the data by the variable(s) given. The
minus sign in front of <code>mean_pass</code> means to sort in
descending order.</p>
<p>Let’s make our first figure:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">schotty</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="op">-</span><span class="va">mean_pass</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">mean_pass</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="beginners_guide_files/figure-html/fig1-1.png" class="r-plt" alt="" width="100%"></p>
<p>This image is kind of a mess – we still need a title, axis labels,
etc – but gets the point across. We’ll get to that other stuff later.
But more importantly, we made something interesting using
<code>nflfastR</code> data! The “reorder” sorts the teams according to
pass rate, with the “-” again saying to do it in descending order. “aes”
is short for “aesthetic”, which is R’s weird way of asking which
variables should go on the x and y axes.</p>
<p>Looking at the figure, the Chiefs will never have playoff success
until they establish the run.</p>
</div>
</div>
<div class="section level2">
<h2 id="loading-multiple-seasons">Loading multiple seasons<a class="anchor" aria-label="anchor" href="#loading-multiple-seasons"></a>
</h2>
<p>Because all the data is stored in the data repository, it is very
fast to load data from multiple seasons.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp</a></span><span class="op">(</span><span class="fl">2015</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span></span></code></pre></div>
<p>This loads play-by-play data from the 2015 through 2019 seasons.</p>
<p>Let’s make sure we got it all. By now, you should understand what
this is doing:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   season     n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   <span style="text-decoration: underline;">2</span>015 <span style="text-decoration: underline;">48</span>122</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   <span style="text-decoration: underline;">2</span>016 <span style="text-decoration: underline;">47</span>651</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   <span style="text-decoration: underline;">2</span>017 <span style="text-decoration: underline;">47</span>245</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   <span style="text-decoration: underline;">2</span>018 <span style="text-decoration: underline;">47</span>109</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   <span style="text-decoration: underline;">2</span>019 <span style="text-decoration: underline;">47</span>260</span></span></code></pre></div>
<p>So each season has about 48,000 plays. Just for fun, let’s look at
the various play types:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">play_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;    play_type       n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> extra_point  <span style="text-decoration: underline;">6</span>240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> field_goal   <span style="text-decoration: underline;">5</span>155</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> kickoff     <span style="text-decoration: underline;">13</span>613</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> no_play     <span style="text-decoration: underline;">22</span>752</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> pass        <span style="text-decoration: underline;">99</span>987</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> punt        <span style="text-decoration: underline;">12</span>083</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> qb_kneel     <span style="text-decoration: underline;">2</span>090</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> qb_spike      340</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> run         <span style="text-decoration: underline;">68</span>128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>           <span style="text-decoration: underline;">6</span>999</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="figures-with-qb-stats">Figures with QB stats<a class="anchor" aria-label="anchor" href="#figures-with-qb-stats"></a>
</h2>
<p>Let’s do some stuff with quarterbacks:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qbs</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qb_epa</span><span class="op">)</span>,</span>
<span>    cpoe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cpoe</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    n_dropbacks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pass</span><span class="op">)</span>,</span>
<span>    n_plays <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    team <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_dropbacks</span> <span class="op">&gt;</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">n_plays</span> <span class="op">&gt;</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">id</span> and <span style="color: #0000BB;">name</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">id</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(id, name))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span></code></pre></div>
<p>Lots of new stuff here. First, we’re grouping by <code>id</code> and
<code>name</code> to make sure we’re getting unique players; i.e., if
two players have the same name (like Javorius Allen and Josh Allen both
being J.Allen), we are also using their id to differentiate them.
<code>qb_epa</code> is an <code>nflfastR</code> creation that is equal
to EPA in all instances except for when a pass is completed and a fumble
is lost, in which case a QB gets “credit” for the play up to the spot
the fumble was lost (making EPA function like passing yards). The
<code>last</code> part in the <code>summarize</code> comment gets the
last team that a player was observed playing with.</p>
<p>My way of getting a dataset with only quarterbacks without joining to
external roster data is to make sure they hit some number of dropbacks.
In this case, filtering with <code>n_dropbacks &gt; 100</code> makes
sure we’re only including quarterbacks. The <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup()</a></code> near
the end is good practice after grouping to make sure you don’t get weird
behavior with the data you created down the line.</p>
<p>Let’s make some more figures. The <code><a href="https://nflreadr.nflverse.com/reference/load_teams.html" class="external-link">load_teams()</a></code> function
is provided in the <code>nflreadr</code> package, so since we have
already loaded the package, it’s ready to use.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html" class="external-link">load_teams</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse teams data</span> ─────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2025-10-01 08:03:15 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 16</span></span></span>
<span><span class="co">#&gt;    team_abbr team_name      team_id team_nick team_conf team_division team_color</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ARI       Arizona Cardi…    <span style="text-decoration: underline;">3</span>800 Cardinals NFC       NFC West      #97233F   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ATL       Atlanta Falco…     200 Falcons   NFC       NFC South     #A71930   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> BAL       Baltimore Rav…     325 Ravens    AFC       AFC North     #241773   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> BUF       Buffalo Bills      610 Bills     AFC       AFC East      #00338D   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CAR       Carolina Pant…     750 Panthers  NFC       NFC South     #0085CA   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CHI       Chicago Bears      810 Bears     NFC       NFC North     #0B162A   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CIN       Cincinnati Be…     920 Bengals   AFC       AFC North     #FB4F14   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CLE       Cleveland Bro…    <span style="text-decoration: underline;">1</span>050 Browns    AFC       AFC North     #FF3C00   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DAL       Dallas Cowboys    <span style="text-decoration: underline;">1</span>200 Cowboys   NFC       NFC East      #002244   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DEN       Denver Broncos    <span style="text-decoration: underline;">1</span>400 Broncos   AFC       AFC West      #002244   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: team_color2 &lt;chr&gt;, team_color3 &lt;chr&gt;, team_color4 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   team_logo_wikipedia &lt;chr&gt;, team_logo_espn &lt;chr&gt;, team_wordmark &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   team_conference_logo &lt;chr&gt;, team_league_logo &lt;chr&gt;, team_logo_squared &lt;chr&gt;</span></span></span></code></pre></div>
<p>Let’s join this to the <code>qbs</code> dataframe we created:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qbs</span> <span class="op">&lt;-</span> <span class="va">qbs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html" class="external-link">load_teams</a></span><span class="op">(</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'team'</span> <span class="op">=</span> <span class="st">'team_abbr'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>left_join</code> means keep all the rows from the left
dataframe (the first one provided, <code>qbs</code>), and join those
rows to available rows in the other dataframe. We also need to provide
the joining variables, <code>team</code> from <code>qbs</code> and
<code>team_abbr</code> from <code><a href="https://nflreadr.nflverse.com/reference/load_teams.html" class="external-link">load_teams()</a></code>. Why do we have to
type <code>by = c('team' = 'team_abbr')</code>? Who knows, but it’s what
<code>left_join</code> requires as instructions for how to match.</p>
<div class="section level3">
<h3 id="with-team-color-dots">With team color dots<a class="anchor" aria-label="anchor" href="#with-team-color-dots"></a>
</h3>
<p>Now we can make a figure!</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qbs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpoe</span>, y <span class="op">=</span> <span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#horizontal line with mean EPA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qbs</span><span class="op">$</span><span class="va">epa</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#vertical line with mean CPOE</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qbs</span><span class="op">$</span><span class="va">cpoe</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add points for the QBs with the right colors</span></span>
<span>  <span class="co">#cex controls point size and alpha the transparency (alpha = 1 is normal)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">qbs</span><span class="op">$</span><span class="va">team_color</span>, cex<span class="op">=</span><span class="va">qbs</span><span class="op">$</span><span class="va">n_plays</span> <span class="op">/</span> <span class="fl">350</span>, alpha <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add names using ggrepel, which tries to make them not overlap</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add a smooth line fitting cpoe + epa</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'line'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, se<span class="op">=</span><span class="cn">FALSE</span>, method<span class="op">=</span><span class="st">'lm'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#titles and caption</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Completion % above expected (CPOE)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"EPA per play (passes, rushes, and penalties)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Quarterback Efficiency, 2015 - 2019"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: @nflfastR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#uses the black and white ggplot theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#center title with hjust = 0.5</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#make ticks look nice</span></span>
<span>  <span class="co">#if this doesn't work, `install.packages('scales')`</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="beginners_guide_files/figure-html/fig2-1.png" class="r-plt" alt="" width="100%"></p>
<p>This looks complicated, but is just a way of getting a bunch of
different stuff on the same plot: we have lines for averages, dots,
names, etc. I added comments above to explain what is going on, but in
practice for making figures I usually just copy and paste stuff and/or
google what I need.</p>
</div>
<div class="section level3">
<h3 id="with-team-logos">With team logos<a class="anchor" aria-label="anchor" href="#with-team-logos"></a>
</h3>
<p>We could also make the same plot with team logos:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qbs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpoe</span>, y <span class="op">=</span> <span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#horizontal line with mean EPA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qbs</span><span class="op">$</span><span class="va">epa</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#vertical line with mean CPOE</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qbs</span><span class="op">$</span><span class="va">cpoe</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add points for the QBs with the logos (this uses nflplotR package)</span></span>
<span>  <span class="fu"><a href="https://nflplotr.nflverse.com/reference/geom_nfl_logos.html" class="external-link">geom_nfl_logos</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>team_abbr <span class="op">=</span> <span class="va">team</span><span class="op">)</span>, width <span class="op">=</span> <span class="va">qbs</span><span class="op">$</span><span class="va">n_plays</span> <span class="op">/</span> <span class="fl">45000</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add names using ggrepel, which tries to make them not overlap</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add a smooth line fitting cpoe + epa</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'line'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, se<span class="op">=</span><span class="cn">FALSE</span>, method<span class="op">=</span><span class="st">'lm'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#titles and caption</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Completion % above expected (CPOE)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"EPA per play (passes, rushes, and penalties)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Quarterback Efficiency, 2015 - 2019"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: @nflfastR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#center title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#make ticks look nice</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="beginners_guide_files/figure-html/fig3-1.png" class="r-plt" alt="" width="100%"></p>
<p>The only changes we’ve made are to use <code>geom_nfl_logos</code>
instead of <code>geom_point</code> (how to figure out the right size for
the images in the <code>width</code> part? Trial and error).</p>
<p>This figure would look better with fewer players shown, but the point
of this is explaining how to do stuff, so let’s call this good
enough.</p>
</div>
<div class="section level3">
<h3 id="team-tiers-plot">Team tiers plot<a class="anchor" aria-label="anchor" href="#team-tiers-plot"></a>
</h3>
<p>If it’s helpful, here are a few notes about the <a href="https://www.nflfastr.com/articles/nflfastR.html#example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season" class="external-link">chart
originally shown here</a>, which like the above uses nflplotR for team
logos.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nflplotr.nflverse.com" class="external-link">nflplotR</a></span><span class="op">)</span></span>
<span><span class="co"># get pbp and filter to regular season rush and pass plays</span></span>
<span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp</a></span><span class="op">(</span><span class="fl">2005</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># offense epa</span></span>
<span><span class="va">offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>off_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># defense epa</span></span>
<span><span class="va">defense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">defteam</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>def_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># make figure</span></span>
<span><span class="va">offense</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">defense</span>, by <span class="op">=</span> <span class="st">"team"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">off_epa</span>, y <span class="op">=</span> <span class="va">def_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># tier lines</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, intercept <span class="op">=</span> <span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># nflplotR magic</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/geom_lines.html" class="external-link">geom_mean_lines</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">off_epa</span>, x0 <span class="op">=</span> <span class="va">def_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/geom_nfl_logos.html" class="external-link">geom_nfl_logos</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>team_abbr <span class="op">=</span> <span class="va">team</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.07</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Offense EPA/play"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Defense EPA/play"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data: @nflfastR"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"2005 NFL Offensive and Defensive EPA per Play"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="beginners_guide_files/figure-html/ex5-1.png" class="r-plt" alt="" width="100%"></p>
<ul>
<li>The <code><a href="https://nflplotr.nflverse.com/reference/geom_lines.html" class="external-link">geom_mean_lines()</a></code> function adds mean lines for
offensive and defensive EPA per play</li>
<li>The slope lines are created using <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline()</a></code>
</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse()</a></code> reverses the vertical axis so that up
= better defense</li>
</ul>
<p>Everything else should be comprehensible by now!</p>
</div>
<div class="section level3">
<h3 id="a-few-more-things-on-plotting">A few more things on plotting<a class="anchor" aria-label="anchor" href="#a-few-more-things-on-plotting"></a>
</h3>
<p>There are two ways to view plots. One is in the RStudio Viewer, which
shows up in RStudio when you plot something. If plots in your RStudio
viewer look ugly and pixelated, you probably need to install the
<code>Cairo</code> package and then set that as the default viewer by
doing Tools –&gt; Global Options –&gt; General –&gt; Graphics –&gt;
Backend: Set to Cairo.</p>
<p>The other is to save a .png with your preferred dimensions and
resolution. For example,
<code>ggsave("test.png", width = 16, height = 9, units = "cm")</code>
would save the current plot as “<code>test.png</code>” with the units
specified (you can view all the ggsave options <a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">here</a>).</p>
<p>One more note: the RStudio Viewer can take a long time to preview
ggplots, especially if you’re doing things like adding images. If you’re
getting frustrated with a plot taking a long time to display, you can
take advantage of <a href="https://nflplotr.nflverse.com/reference/ggpreview.html" class="external-link">ggpreview</a>
from <code>nflplotR</code>. To do this, first save the plot to an object
and then run <code>ggpreview</code> on it (if this doesn’t make sense,
see the examples <a href="https://nflplotr.nflverse.com/reference/ggpreview.html" class="external-link">here</a>).</p>
</div>
</div>
<div class="section level2">
<h2 id="real-life-example-lets-make-a-win-total-model">Real life example: let’s make a win total model<a class="anchor" aria-label="anchor" href="#real-life-example-lets-make-a-win-total-model"></a>
</h2>
<p>I’m going to try to go through the process of cleaning and joining
multiple data sets to try to get a sense of how I would approach
something like this, step-by-step.</p>
<div class="section level3">
<h3 id="get-team-wins-each-season">Get team wins each season<a class="anchor" aria-label="anchor" href="#get-team-wins-each-season"></a>
</h3>
<p>We’re going to cheat a little and take advantage of Lee Sharpe’s
famous <code>games</code> file. Most of this stuff has been added into
<code>nflfastR</code>, but it’s easier working with this file where each
game is one row. If you’re curious, the triple colon is a way to access
what is referred to as non-exported functions in a package. Think of
this as like a secret menu (why is this secret? Sometimes package
developers want to limit the number of exported functions as to be not
overwhelming).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">games</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_schedules.html" class="external-link">load_schedules</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">games</span><span class="op">)</span></span>
<span><span class="co">#&gt; nflvrs_d [7,276 × 46] (S3: nflverse_data/tbl_df/tbl/data.table/data.frame)</span></span>
<span><span class="co">#&gt;  $ game_id         : chr [1:7276] "1999_01_MIN_ATL" "1999_01_KC_CHI" "1999_01_PIT_CLE" "1999_01_OAK_GB" ...</span></span>
<span><span class="co">#&gt;  $ season          : int [1:7276] 1999 1999 1999 1999 1999 1999 1999 1999 1999 1999 ...</span></span>
<span><span class="co">#&gt;  $ game_type       : chr [1:7276] "REG" "REG" "REG" "REG" ...</span></span>
<span><span class="co">#&gt;  $ week            : int [1:7276] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ gameday         : chr [1:7276] "1999-09-12" "1999-09-12" "1999-09-12" "1999-09-12" ...</span></span>
<span><span class="co">#&gt;  $ weekday         : chr [1:7276] "Sunday" "Sunday" "Sunday" "Sunday" ...</span></span>
<span><span class="co">#&gt;  $ gametime        : chr [1:7276] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ away_team       : chr [1:7276] "MIN" "KC" "PIT" "OAK" ...</span></span>
<span><span class="co">#&gt;  $ away_score      : int [1:7276] 17 17 43 24 14 3 10 30 25 28 ...</span></span>
<span><span class="co">#&gt;  $ home_team       : chr [1:7276] "ATL" "CHI" "CLE" "GB" ...</span></span>
<span><span class="co">#&gt;  $ home_score      : int [1:7276] 14 20 0 28 31 41 19 28 24 20 ...</span></span>
<span><span class="co">#&gt;  $ location        : chr [1:7276] "Home" "Home" "Home" "Home" ...</span></span>
<span><span class="co">#&gt;  $ result          : int [1:7276] -3 3 -43 4 17 38 9 -2 -1 -8 ...</span></span>
<span><span class="co">#&gt;  $ total           : int [1:7276] 31 37 43 52 45 44 29 58 49 48 ...</span></span>
<span><span class="co">#&gt;  $ overtime        : int [1:7276] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ old_game_id     : chr [1:7276] "1999091210" "1999091206" "1999091213" "1999091208" ...</span></span>
<span><span class="co">#&gt;  $ gsis            : int [1:7276] 598 597 604 602 591 603 592 600 588 596 ...</span></span>
<span><span class="co">#&gt;  $ nfl_detail_id   : chr [1:7276] NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ pfr             : chr [1:7276] "199909120atl" "199909120chi" "199909120cle" "199909120gnb" ...</span></span>
<span><span class="co">#&gt;  $ pff             : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ espn            : chr [1:7276] "190912001" "190912003" "190912005" "190912009" ...</span></span>
<span><span class="co">#&gt;  $ ftn             : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ away_rest       : int [1:7276] 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">#&gt;  $ home_rest       : int [1:7276] 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">#&gt;  $ away_moneyline  : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ home_moneyline  : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ spread_line     : num [1:7276] -4 -3 -6 9 -3 5.5 3.5 7 -3 9.5 ...</span></span>
<span><span class="co">#&gt;  $ away_spread_odds: int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ home_spread_odds: int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ total_line      : num [1:7276] 49 38 37 43 45.5 49 38 44.5 37 42 ...</span></span>
<span><span class="co">#&gt;  $ under_odds      : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ over_odds       : int [1:7276] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ div_game        : int [1:7276] 0 0 1 0 1 0 1 1 1 0 ...</span></span>
<span><span class="co">#&gt;  $ roof            : chr [1:7276] "dome" "outdoors" "outdoors" "outdoors" ...</span></span>
<span><span class="co">#&gt;  $ surface         : chr [1:7276] "astroturf" "grass" "grass" "grass" ...</span></span>
<span><span class="co">#&gt;  $ temp            : int [1:7276] NA 80 78 67 NA 76 NA 73 75 NA ...</span></span>
<span><span class="co">#&gt;  $ wind            : int [1:7276] NA 12 12 10 NA 8 NA 5 3 NA ...</span></span>
<span><span class="co">#&gt;  $ away_qb_id      : chr [1:7276] "00-0003761" "00-0006300" "00-0015700" "00-0005741" ...</span></span>
<span><span class="co">#&gt;  $ home_qb_id      : chr [1:7276] "00-0002876" "00-0010560" "00-0004230" "00-0005106" ...</span></span>
<span><span class="co">#&gt;  $ away_qb_name    : chr [1:7276] "Randall Cunningham" "Elvis Grbac" "Kordell Stewart" "Rich Gannon" ...</span></span>
<span><span class="co">#&gt;  $ home_qb_name    : chr [1:7276] "Chris Chandler" "Shane Matthews" "Ty Detmer" "Brett Favre" ...</span></span>
<span><span class="co">#&gt;  $ away_coach      : chr [1:7276] "Dennis Green" "Gunther Cunningham" "Bill Cowher" "Jon Gruden" ...</span></span>
<span><span class="co">#&gt;  $ home_coach      : chr [1:7276] "Dan Reeves" "Dick Jauron" "Chris Palmer" "Ray Rhodes" ...</span></span>
<span><span class="co">#&gt;  $ referee         : chr [1:7276] "Gerry Austin" "Phil Luckett" "Bob McElwee" "Tony Corrente" ...</span></span>
<span><span class="co">#&gt;  $ stadium_id      : chr [1:7276] "ATL00" "CHI98" "CLE00" "GNB00" ...</span></span>
<span><span class="co">#&gt;  $ stadium         : chr [1:7276] "Georgia Dome" "Soldier Field" "Cleveland Browns Stadium" "Lambeau Field" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "nflverse_type")= chr "games and schedules"</span></span>
<span><span class="co">#&gt;  - attr(*, "nflverse_timestamp")= chr "2026-02-11 02:56:12 EST"</span></span></code></pre></div>
<p>To start, we want to create a dataframe where each row is a
team-season observation, listing how many games they won. There are
multiple ways to do this, but I’m going to just take the home and away
results and bind together. As an example, here’s what the
<code>home</code> results look like:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">home</span> <span class="op">&lt;-</span> <span class="va">games</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">game_type</span> <span class="op">==</span> <span class="st">'REG'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">week</span>, <span class="va">home_team</span>, <span class="va">result</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">home_team</span><span class="op">)</span></span>
<span><span class="va">home</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse games and schedules</span> ────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2026-02-11 07:56:12 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   season  week team  result</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   <span style="text-decoration: underline;">1</span>999     1 ATL       -<span style="color: #BB0000;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   <span style="text-decoration: underline;">1</span>999     1 CHI        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   <span style="text-decoration: underline;">1</span>999     1 CLE      -<span style="color: #BB0000;">43</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   <span style="text-decoration: underline;">1</span>999     1 GB         4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   <span style="text-decoration: underline;">1</span>999     1 IND       17</span></span></code></pre></div>
<p>Note that we used <code>rename</code> to change
<code>home_team</code> to <code>team</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">away</span> <span class="op">&lt;-</span> <span class="va">games</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">game_type</span> <span class="op">==</span> <span class="st">'REG'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">week</span>, <span class="va">away_team</span>, <span class="va">result</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">away_team</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>result <span class="op">=</span> <span class="op">-</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="va">away</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse games and schedules</span> ────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2026-02-11 07:56:12 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   season  week team  result</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   <span style="text-decoration: underline;">1</span>999     1 MIN        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   <span style="text-decoration: underline;">1</span>999     1 KC        -<span style="color: #BB0000;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   <span style="text-decoration: underline;">1</span>999     1 PIT       43</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   <span style="text-decoration: underline;">1</span>999     1 OAK       -<span style="color: #BB0000;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   <span style="text-decoration: underline;">1</span>999     1 BUF      -<span style="color: #BB0000;">17</span></span></span></code></pre></div>
<p>For away teams, we need to flip the result since result is given from
the perspective of the home team. Now let’s make a columns called
<code>win</code> based on the result.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">home</span>, <span class="va">away</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    win <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">result</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">result</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>      <span class="va">result</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2019</span> <span class="op">&amp;</span> <span class="va">team</span> <span class="op">==</span> <span class="st">'SEA'</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse games and schedules</span> ────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2026-02-11 07:56:12 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 5</span></span></span>
<span><span class="co">#&gt;    season  week team  result   win</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   <span style="text-decoration: underline;">2</span>019     1 SEA        1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   <span style="text-decoration: underline;">2</span>019     2 SEA        2     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   <span style="text-decoration: underline;">2</span>019     3 SEA       -<span style="color: #BB0000;">6</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   <span style="text-decoration: underline;">2</span>019     4 SEA       17     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   <span style="text-decoration: underline;">2</span>019     5 SEA        1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   <span style="text-decoration: underline;">2</span>019     6 SEA        4     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   <span style="text-decoration: underline;">2</span>019     7 SEA      -<span style="color: #BB0000;">14</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   <span style="text-decoration: underline;">2</span>019     8 SEA        7     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   <span style="text-decoration: underline;">2</span>019     9 SEA        6     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   <span style="text-decoration: underline;">2</span>019    10 SEA        3     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>   <span style="text-decoration: underline;">2</span>019    12 SEA        8     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>   <span style="text-decoration: underline;">2</span>019    13 SEA        7     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>   <span style="text-decoration: underline;">2</span>019    14 SEA      -<span style="color: #BB0000;">16</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>   <span style="text-decoration: underline;">2</span>019    15 SEA        6     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>   <span style="text-decoration: underline;">2</span>019    16 SEA      -<span style="color: #BB0000;">14</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>   <span style="text-decoration: underline;">2</span>019    17 SEA       -<span style="color: #BB0000;">5</span>     0</span></span></code></pre></div>
<p>Doing the
<code>results |&gt; filter(season == 2019 &amp; team == 'SEA')</code>
part at the end isn’t actually for saving the data in a new form, but
just making sure the previous step did what I wanted. This is a good
habit to get into: frequently inspect your data and make sure it looks
like you think it should.</p>
<p>Now that we have the dataframe we wanted, we can get team wins by
season easily:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_wins</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">team</span>, <span class="va">season</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    wins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">win</span><span class="op">)</span>,</span>
<span>    point_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">team</span> and <span style="color: #0000BB;">season</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">team</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(team, season))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span>
<span></span>
<span><span class="va">team_wins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">wins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   team  season  wins point_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> NE      <span style="text-decoration: underline;">2</span>007    16        315</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> CAR     <span style="text-decoration: underline;">2</span>015    15        192</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> DET     <span style="text-decoration: underline;">2</span>024    15        222</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GB      <span style="text-decoration: underline;">2</span>011    15        201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> KC      <span style="text-decoration: underline;">2</span>024    15         59</span></span></code></pre></div>
<p>Again, we’re making sure the data looks like it “should” by checking
the 5 seasons with the most wins, and making sure it looks right.</p>
<p>Now that the team-season win and point differential data is ready, we
need to go back to the <code>nflfastR</code> data to get EPA/play.</p>
</div>
<div class="section level3">
<h3 id="get-team-epa-by-season">Get team EPA by season<a class="anchor" aria-label="anchor" href="#get-team-epa-by-season"></a>
</h3>
<p>Let’s start by getting data from every season from the
<code>nflfastR</code> data repository:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html" class="external-link">load_pbp</a></span><span class="op">(</span><span class="fl">1999</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>    <span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span>,</span>
<span>    <span class="va">posteam</span> <span class="op">!=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">posteam</span>, <span class="va">pass</span>, <span class="va">defteam</span>, <span class="va">epa</span><span class="op">)</span></span></code></pre></div>
<p>I’m being pretty aggressive with dropping rows and columns
(<code>filter</code> and <code>select</code>) because otherwise loading
this all into memory can be painful on the computer. But this is all we
need for what we’re doing. Note that I’m only keeping regular season
games here (<code>season_type == "REG"</code>) since this is how this
analysis is usually done.</p>
<p>Now we can get EPA/play on offense and defense. Let’s break it out by
pass and rush too. I don’t remember how to do some of this so let’s do
it in steps. We know we need to group by team, season, and pass, so
there’s the beginning:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">season</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">posteam</span>, <span style="color: #0000BB;">season</span>, and <span style="color: #0000BB;">pass</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">posteam</span> and <span style="color: #0000BB;">season</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(posteam, season, pass))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   posteam, season [2]</span></span></span>
<span><span class="co">#&gt;   posteam season  pass     epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ARI       <span style="text-decoration: underline;">1</span>999     0 -<span style="color: #BB0000;">0.226</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ARI       <span style="text-decoration: underline;">1</span>999     1 -<span style="color: #BB0000;">0.150</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ARI       <span style="text-decoration: underline;">2</span>000     0 -<span style="color: #BB0000;">0.247</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ARI       <span style="text-decoration: underline;">2</span>000     1 -<span style="color: #BB0000;">0.069</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span></code></pre></div>
<p>But this makes two rows per team-season. How to get each team-season
on the same row? <code>pivot_wider</code> is what we need:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">season</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">pass</span>, values_from <span class="op">=</span> <span class="va">epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">posteam</span>, <span style="color: #0000BB;">season</span>, and <span style="color: #0000BB;">pass</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">posteam</span> and <span style="color: #0000BB;">season</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(posteam, season, pass))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   posteam, season [4]</span></span></span>
<span><span class="co">#&gt;   posteam season    `0`     `1`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ARI       <span style="text-decoration: underline;">1</span>999 -<span style="color: #BB0000;">0.226</span> -<span style="color: #BB0000;">0.150</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ARI       <span style="text-decoration: underline;">2</span>000 -<span style="color: #BB0000;">0.247</span> -<span style="color: #BB0000;">0.069</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ARI       <span style="text-decoration: underline;">2</span>001 -<span style="color: #BB0000;">0.179</span>  0.072<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ARI       <span style="text-decoration: underline;">2</span>002 -<span style="color: #BB0000;">0.160</span> -<span style="color: #BB0000;">0.051</span><span style="color: #BB0000; text-decoration: underline;">7</span></span></span></code></pre></div>
<p>This one is hard to wrap my head around so I usually open up the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">reference
page</a>, read the example, and pray that what I try works. In this case
it did. Hooray! This turned our two-lines-per-team dataframe into one,
with the 0 column being pass == 0 (run plays) and the 1 column pass ==
1.</p>
<p>Now let’s rename to something more sensible and save:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">season</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">pass</span>, values_from <span class="op">=</span> <span class="va">epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>off_pass_epa <span class="op">=</span> <span class="va">`1`</span>, off_rush_epa <span class="op">=</span> <span class="va">`0`</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">posteam</span>, <span style="color: #0000BB;">season</span>, and <span style="color: #0000BB;">pass</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">posteam</span> and <span style="color: #0000BB;">season</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(posteam, season, pass))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span></code></pre></div>
<p>Note that variable names that are numbers need to be surrounded in
tick marks for this to work.</p>
<p>Now we can repeat the same process for defense:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">defense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">defteam</span>, <span class="va">season</span>, <span class="va">pass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">pass</span>, values_from <span class="op">=</span> <span class="va">epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>def_pass_epa <span class="op">=</span> <span class="va">`1`</span>, def_rush_epa <span class="op">=</span> <span class="va">`0`</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has regrouped the output.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Summaries were computed grouped by <span style="color: #0000BB;">defteam</span>, <span style="color: #0000BB;">season</span>, and <span style="color: #0000BB;">pass</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Output is grouped by <span style="color: #0000BB;">defteam</span> and <span style="color: #0000BB;">season</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.groups = "drop_last")` to silence this message.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `summarise(.by = c(defteam, season, pass))` for per-operation grouping</span></span>
<span><span class="co">#&gt;   (`?dplyr::dplyr_by`) instead.</span></span></code></pre></div>
<p>Let’s do another sanity check looking at the top 5 pass offenses and
defenses:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#top 5 offenses</span></span>
<span><span class="va">offense</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">off_pass_epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   posteam, season [5]</span></span></span>
<span><span class="co">#&gt;   posteam season off_rush_epa off_pass_epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> NE        <span style="text-decoration: underline;">2</span>007      0.003<span style="text-decoration: underline;">80</span>        0.422</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> IND       <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">81</span>        0.412</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GB        <span style="text-decoration: underline;">2</span>011     -<span style="color: #BB0000;">0.114</span>          0.403</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> KC        <span style="text-decoration: underline;">2</span>018      0.020<span style="text-decoration: underline;">9</span>         0.348</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> DEN       <span style="text-decoration: underline;">2</span>013     -<span style="color: #BB0000;">0.029</span><span style="color: #BB0000; text-decoration: underline;">6</span>         0.344</span></span>
<span></span>
<span><span class="co">#top 5 defenses</span></span>
<span><span class="va">defense</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">def_pass_epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   defteam, season [5]</span></span></span>
<span><span class="co">#&gt;   defteam season def_rush_epa def_pass_epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TB        <span style="text-decoration: underline;">2</span>002      -<span style="color: #BB0000;">0.075</span><span style="color: #BB0000; text-decoration: underline;">7</span>       -<span style="color: #BB0000;">0.290</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> NE        <span style="text-decoration: underline;">2</span>019      -<span style="color: #BB0000;">0.168</span>        -<span style="color: #BB0000;">0.241</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> JAX       <span style="text-decoration: underline;">2</span>017      -<span style="color: #BB0000;">0.141</span>        -<span style="color: #BB0000;">0.223</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> NYJ       <span style="text-decoration: underline;">2</span>009      -<span style="color: #BB0000;">0.103</span>        -<span style="color: #BB0000;">0.221</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> BAL       <span style="text-decoration: underline;">2</span>008      -<span style="color: #BB0000;">0.236</span>        -<span style="color: #BB0000;">0.207</span></span></span></code></pre></div>
<p>The top pass defenses (2002 TB, 2017 JAX, 2019 NE) and offenses (2007
Pats, 2004 Colts, 2011 Packers) definitely check out!</p>
</div>
<div class="section level3">
<h3 id="fix-team-names-and-join">Fix team names and join<a class="anchor" aria-label="anchor" href="#fix-team-names-and-join"></a>
</h3>
<p>Now we’re ready to bind it all together. Actually, let’s make sure
all the team names are ready too.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_wins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">team</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 35 × 2</span></span></span>
<span><span class="co">#&gt;    team      n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> LV        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> LAC       9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> LA       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> STL      17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SD       18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> OAK      21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HOU      24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ARI      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ATL      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> BAL      27</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span></code></pre></div>
<p>Nope, not yet, we need to fix the Raiders, Rams, and Chargers, which
are LV, LA, and LAC in <code>nflfastR</code>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_wins</span> <span class="op">&lt;-</span> <span class="va">team_wins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    team <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">team</span> <span class="op">==</span> <span class="st">'OAK'</span> <span class="op">~</span> <span class="st">'LV'</span>,</span>
<span>      <span class="va">team</span> <span class="op">==</span> <span class="st">'SD'</span> <span class="op">~</span> <span class="st">'LAC'</span>,</span>
<span>      <span class="va">team</span> <span class="op">==</span> <span class="st">'STL'</span> <span class="op">~</span> <span class="st">'LA'</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">team</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The <code>TRUE</code> statement at the bottom says that if none of
the above cases are found, keep team the same. Let’s make sure this
worked:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_wins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">team</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 2</span></span></span>
<span><span class="co">#&gt;    team      n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HOU      24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ARI      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ATL      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> BAL      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> BUF      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CAR      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CHI      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CIN      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> CLE      27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DAL      27</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre></div>
<p>HOU has 3 fewer seasons because it didn’t exist from 1999 through
2001, which is fine, and all the other team names have number of seasons
that they should. Okay NOW we can join:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">team_wins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">offense</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'team'</span> <span class="op">=</span> <span class="st">'posteam'</span>, <span class="st">'season'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">defense</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'team'</span> <span class="op">=</span> <span class="st">'defteam'</span>, <span class="st">'season'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">team</span> <span class="op">==</span> <span class="st">'SEA'</span> <span class="op">&amp;</span> <span class="va">season</span> <span class="op">&gt;=</span> <span class="fl">2012</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 8</span></span></span>
<span><span class="co">#&gt;    team  season  wins point_diff off_rush_epa off_pass_epa def_rush_epa</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SEA     <span style="text-decoration: underline;">2</span>012  11          167     -<span style="color: #BB0000;">0.004</span><span style="color: #BB0000; text-decoration: underline;">76</span>       0.213       -<span style="color: #BB0000;">0.073</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SEA     <span style="text-decoration: underline;">2</span>013  13          186     -<span style="color: #BB0000;">0.101</span>         0.188       -<span style="color: #BB0000;">0.128</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SEA     <span style="text-decoration: underline;">2</span>014  12          140      0.029<span style="text-decoration: underline;">5</span>        0.139       -<span style="color: #BB0000;">0.231</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SEA     <span style="text-decoration: underline;">2</span>015  10          146     -<span style="color: #BB0000;">0.104</span>         0.249       -<span style="color: #BB0000;">0.148</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SEA     <span style="text-decoration: underline;">2</span>016  10.5         62     -<span style="color: #BB0000;">0.126</span>         0.102       -<span style="color: #BB0000;">0.207</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SEA     <span style="text-decoration: underline;">2</span>017   9           34     -<span style="color: #BB0000;">0.192</span>         0.058<span style="text-decoration: underline;">4</span>      -<span style="color: #BB0000;">0.122</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SEA     <span style="text-decoration: underline;">2</span>018  10           81     -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">3</span>        0.210       -<span style="color: #BB0000;">0.130</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SEA     <span style="text-decoration: underline;">2</span>019  11            7     -<span style="color: #BB0000;">0.136</span>         0.119       -<span style="color: #BB0000;">0.093</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SEA     <span style="text-decoration: underline;">2</span>020  12           88     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SEA     <span style="text-decoration: underline;">2</span>021   7           29     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> SEA     <span style="text-decoration: underline;">2</span>022   9            6     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> SEA     <span style="text-decoration: underline;">2</span>023   9          -<span style="color: #BB0000;">38</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> SEA     <span style="text-decoration: underline;">2</span>024  10            7     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> SEA     <span style="text-decoration: underline;">2</span>025  14          191     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: def_pass_epa &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we’re getting really close to doing what we want! Next we need to
create new columns for prior year EPA, and let’s do point differential
too.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">team</span>, <span class="va">season</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">team</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    prior_off_rush_epa <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">off_rush_epa</span><span class="op">)</span>,</span>
<span>    prior_off_pass_epa <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">off_pass_epa</span><span class="op">)</span>,</span>
<span>    prior_def_rush_epa <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">def_rush_epa</span><span class="op">)</span>,</span>
<span>    prior_def_pass_epa <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">def_pass_epa</span><span class="op">)</span>,</span>
<span>    prior_point_diff <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">point_diff</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 13</span></span></span>
<span><span class="co">#&gt;   team  season  wins point_diff off_rush_epa off_pass_epa def_rush_epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ARI     <span style="text-decoration: underline;">1</span>999     6       -<span style="color: #BB0000;">137</span>       -<span style="color: #BB0000;">0.226</span>      -<span style="color: #BB0000;">0.150</span>       -<span style="color: #BB0000;">0.033</span><span style="color: #BB0000; text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ARI     <span style="text-decoration: underline;">2</span>000     3       -<span style="color: #BB0000;">233</span>       -<span style="color: #BB0000;">0.247</span>      -<span style="color: #BB0000;">0.069</span><span style="color: #BB0000; text-decoration: underline;">6</span>       0.015<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ARI     <span style="text-decoration: underline;">2</span>001     7        -<span style="color: #BB0000;">48</span>       -<span style="color: #BB0000;">0.179</span>       0.072<span style="text-decoration: underline;">7</span>      -<span style="color: #BB0000;">0.077</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ARI     <span style="text-decoration: underline;">2</span>002     5       -<span style="color: #BB0000;">155</span>       -<span style="color: #BB0000;">0.160</span>      -<span style="color: #BB0000;">0.051</span><span style="color: #BB0000; text-decoration: underline;">7</span>      -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ARI     <span style="text-decoration: underline;">2</span>003     4       -<span style="color: #BB0000;">227</span>       -<span style="color: #BB0000;">0.234</span>      -<span style="color: #BB0000;">0.112</span>       -<span style="color: #BB0000;">0.089</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: def_pass_epa &lt;dbl&gt;, prior_off_rush_epa &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prior_off_pass_epa &lt;dbl&gt;, prior_def_rush_epa &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prior_def_pass_epa &lt;dbl&gt;, prior_point_diff &lt;int&gt;</span></span></span></code></pre></div>
<p>Finally! Now we have the data in place and can start doing things
with it.</p>
</div>
<div class="section level3">
<h3 id="correlations-and-regressions">Correlations and regressions<a class="anchor" aria-label="anchor" href="#correlations-and-regressions"></a>
</h3>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">team</span>, <span class="op">-</span><span class="va">season</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span>use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     wins point_diff off_rush_epa off_pass_epa def_rush_epa</span></span>
<span><span class="co">#&gt; wins                1.00       0.92         0.43         0.70        -0.29</span></span>
<span><span class="co">#&gt; point_diff          0.92       1.00         0.47         0.75        -0.34</span></span>
<span><span class="co">#&gt; off_rush_epa        0.43       0.47         1.00         0.42         0.04</span></span>
<span><span class="co">#&gt; off_pass_epa        0.70       0.75         0.42         1.00        -0.01</span></span>
<span><span class="co">#&gt; def_rush_epa       -0.29      -0.34         0.04        -0.01         1.00</span></span>
<span><span class="co">#&gt; def_pass_epa       -0.57      -0.62        -0.05        -0.10         0.31</span></span>
<span><span class="co">#&gt; prior_off_rush_epa  0.24       0.26         0.32         0.23         0.04</span></span>
<span><span class="co">#&gt; prior_off_pass_epa  0.29       0.32         0.19         0.46         0.00</span></span>
<span><span class="co">#&gt; prior_def_rush_epa -0.12      -0.15         0.03        -0.03         0.27</span></span>
<span><span class="co">#&gt; prior_def_pass_epa -0.18      -0.20        -0.08        -0.05         0.06</span></span>
<span><span class="co">#&gt; prior_point_diff    0.36       0.41         0.21         0.36        -0.09</span></span>
<span><span class="co">#&gt;                    def_pass_epa prior_off_rush_epa prior_off_pass_epa</span></span>
<span><span class="co">#&gt; wins                      -0.57               0.24               0.29</span></span>
<span><span class="co">#&gt; point_diff                -0.62               0.26               0.32</span></span>
<span><span class="co">#&gt; off_rush_epa              -0.05               0.32               0.19</span></span>
<span><span class="co">#&gt; off_pass_epa              -0.10               0.23               0.46</span></span>
<span><span class="co">#&gt; def_rush_epa               0.31               0.04               0.00</span></span>
<span><span class="co">#&gt; def_pass_epa               1.00              -0.10               0.00</span></span>
<span><span class="co">#&gt; prior_off_rush_epa        -0.10               1.00               0.42</span></span>
<span><span class="co">#&gt; prior_off_pass_epa         0.00               0.42               1.00</span></span>
<span><span class="co">#&gt; prior_def_rush_epa         0.16               0.05              -0.01</span></span>
<span><span class="co">#&gt; prior_def_pass_epa         0.27              -0.02              -0.08</span></span>
<span><span class="co">#&gt; prior_point_diff          -0.19               0.47               0.75</span></span>
<span><span class="co">#&gt;                    prior_def_rush_epa prior_def_pass_epa prior_point_diff</span></span>
<span><span class="co">#&gt; wins                            -0.12              -0.18             0.36</span></span>
<span><span class="co">#&gt; point_diff                      -0.15              -0.20             0.41</span></span>
<span><span class="co">#&gt; off_rush_epa                     0.03              -0.08             0.21</span></span>
<span><span class="co">#&gt; off_pass_epa                    -0.03              -0.05             0.36</span></span>
<span><span class="co">#&gt; def_rush_epa                     0.27               0.06            -0.09</span></span>
<span><span class="co">#&gt; def_pass_epa                     0.16               0.27            -0.19</span></span>
<span><span class="co">#&gt; prior_off_rush_epa               0.05              -0.02             0.47</span></span>
<span><span class="co">#&gt; prior_off_pass_epa              -0.01              -0.08             0.75</span></span>
<span><span class="co">#&gt; prior_def_rush_epa               1.00               0.32            -0.35</span></span>
<span><span class="co">#&gt; prior_def_pass_epa               0.32               1.00            -0.60</span></span>
<span><span class="co">#&gt; prior_point_diff                -0.35              -0.60             1.00</span></span></code></pre></div>
<p>We’ve covered <code>select</code>, but here we see a new use where a
minus sign de-selects variables (we need to de-select team name for
correlation to work because it doesn’t work for character strings, and
correlation with the season number itself is meaningless). We’ve run the
correlation on this dataframe, removing missing values, and then
rounding to 2 digits. Not surprisingly, we see that wins in the current
season are more strongly related to passing offense EPA than rushing EPA
or defense EPA, and prior offense carries more predictive power than
prior defense. Pass offense is more stable year to year
(<code>0.46</code>) than rush offense (<code>0.32</code>), pass defense
(<code>0.27</code>), or rush defense (<code>0.27</code>).</p>
<p>I’m actually surprised that the values for passing offense aren’t
higher relative to the others. Maybe it was because most of our prior
results come from the <code>nflscrapR</code> era (2009 - 2019)? Let’s
check what this looks like since 2009 relative to earlier seasons:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"2009 through 2019"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2009 through 2019</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">&gt;=</span> <span class="fl">2009</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">wins</span>, <span class="va">point_diff</span>, <span class="va">off_pass_epa</span>, <span class="va">off_rush_epa</span>, <span class="va">prior_point_diff</span>, <span class="va">prior_off_pass_epa</span>, <span class="va">prior_off_rush_epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span>use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    wins point_diff off_pass_epa off_rush_epa prior_point_diff</span></span>
<span><span class="co">#&gt; wins               1.00       0.92         0.73         0.40             0.43</span></span>
<span><span class="co">#&gt; point_diff         0.92       1.00         0.79         0.46             0.44</span></span>
<span><span class="co">#&gt; off_pass_epa       0.73       0.79         1.00         0.37             0.39</span></span>
<span><span class="co">#&gt; off_rush_epa       0.40       0.46         0.37         1.00             0.19</span></span>
<span><span class="co">#&gt; prior_point_diff   0.43       0.44         0.39         0.19             1.00</span></span>
<span><span class="co">#&gt; prior_off_pass_epa 0.34       0.36         0.45         0.10             0.78</span></span>
<span><span class="co">#&gt; prior_off_rush_epa 0.24       0.25         0.17         0.24             0.45</span></span>
<span><span class="co">#&gt;                    prior_off_pass_epa prior_off_rush_epa</span></span>
<span><span class="co">#&gt; wins                             0.34               0.24</span></span>
<span><span class="co">#&gt; point_diff                       0.36               0.25</span></span>
<span><span class="co">#&gt; off_pass_epa                     0.45               0.17</span></span>
<span><span class="co">#&gt; off_rush_epa                     0.10               0.24</span></span>
<span><span class="co">#&gt; prior_point_diff                 0.78               0.45</span></span>
<span><span class="co">#&gt; prior_off_pass_epa               1.00               0.35</span></span>
<span><span class="co">#&gt; prior_off_rush_epa               0.35               1.00</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"1999 through 2008"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1999 through 2008</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">&lt;</span> <span class="fl">2009</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">wins</span>, <span class="va">point_diff</span>, <span class="va">off_pass_epa</span>, <span class="va">off_rush_epa</span>, <span class="va">prior_point_diff</span>, <span class="va">prior_off_pass_epa</span>, <span class="va">prior_off_rush_epa</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span>use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    wins point_diff off_pass_epa off_rush_epa prior_point_diff</span></span>
<span><span class="co">#&gt; wins               1.00       0.92         0.68         0.47             0.28</span></span>
<span><span class="co">#&gt; point_diff         0.92       1.00         0.72         0.49             0.36</span></span>
<span><span class="co">#&gt; off_pass_epa       0.68       0.72         1.00         0.49             0.33</span></span>
<span><span class="co">#&gt; off_rush_epa       0.47       0.49         0.49         1.00             0.24</span></span>
<span><span class="co">#&gt; prior_point_diff   0.28       0.36         0.33         0.24             1.00</span></span>
<span><span class="co">#&gt; prior_off_pass_epa 0.24       0.29         0.45         0.31             0.72</span></span>
<span><span class="co">#&gt; prior_off_rush_epa 0.24       0.27         0.30         0.41             0.49</span></span>
<span><span class="co">#&gt;                    prior_off_pass_epa prior_off_rush_epa</span></span>
<span><span class="co">#&gt; wins                             0.24               0.24</span></span>
<span><span class="co">#&gt; point_diff                       0.29               0.27</span></span>
<span><span class="co">#&gt; off_pass_epa                     0.45               0.30</span></span>
<span><span class="co">#&gt; off_rush_epa                     0.31               0.41</span></span>
<span><span class="co">#&gt; prior_point_diff                 0.72               0.49</span></span>
<span><span class="co">#&gt; prior_off_pass_epa               1.00               0.50</span></span>
<span><span class="co">#&gt; prior_off_rush_epa               0.50               1.00</span></span></code></pre></div>
<p>Yep, that seems to be the case. So in the more recent period, passing
offense has become slightly more stable but more predictive of
following-year success, while at the same time rushing offense has
become substantially less stable and less predictive of future team
success.</p>
<p>Now let’s do a basic regression of wins on prior offense and defense
EPA/play. Maybe we should only look at this more recent period to fit
our model since it’s more relevant for 2020. In the real world, we would
be more rigorous about making decisions like this, but let’s proceed
anyway.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">&gt;=</span> <span class="fl">2009</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">wins</span> <span class="op">~</span> <span class="va">prior_off_pass_epa</span>  <span class="op">+</span> <span class="va">prior_off_rush_epa</span> <span class="op">+</span> <span class="va">prior_def_pass_epa</span> <span class="op">+</span> <span class="va">prior_def_rush_epa</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = wins ~ prior_off_pass_epa + prior_off_rush_epa + </span></span>
<span><span class="co">#&gt;     prior_def_pass_epa + prior_def_rush_epa, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -7.7025 -1.8874  0.0603  2.2697  7.0855 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error t value             Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)           7.981      0.388  20.573 &lt; 0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; prior_off_pass_epa    6.574      1.281   5.134          0.000000455 ***</span></span>
<span><span class="co">#&gt; prior_off_rush_epa    6.053      2.274   2.661              0.00812 ** </span></span>
<span><span class="co">#&gt; prior_def_pass_epa   -4.094      1.646  -2.487              0.01330 *  </span></span>
<span><span class="co">#&gt; prior_def_rush_epa   -5.048      2.336  -2.161              0.03129 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.861 on 379 degrees of freedom</span></span>
<span><span class="co">#&gt;   (160 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.1633, Adjusted R-squared:  0.1545 </span></span>
<span><span class="co">#&gt; F-statistic: 18.49 on 4 and 379 DF,  p-value: 0.00000000000006782</span></span></code></pre></div>
<p>I’m actually pretty surprised passing offense isn’t higher here. How
does this compare to simply using point differential?</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">wins</span> <span class="op">~</span> <span class="va">prior_point_diff</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = wins ~ prior_point_diff, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -7.205 -2.079  0.126  2.175  7.451 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error t value            Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)       8.14522    0.12273   66.36 &lt;0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; prior_point_diff  0.01247    0.00121   10.31 &lt;0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.863 on 542 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.1639, Adjusted R-squared:  0.1623 </span></span>
<span><span class="co">#&gt; F-statistic: 106.2 on 1 and 542 DF,  p-value: &lt; 0.00000000000000022</span></span></code></pre></div>
<p>So R2 is somewhat higher for just point differential. This isn’t
surprising as we’ve thrown away special teams plays and haven’t
attempted to make any adjustments for things like fumble luck that we
know can improve EPA’s predictive power.</p>
</div>
<div class="section level3">
<h3 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<p>Now let’s get the predictions from the EPA model:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#was just a vector, need a tibble to bind</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#make the column name make sense</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#get names</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">team</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">prediction</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   prediction team </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       11.5 BAL  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       10.2 SF   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        9.8 NE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        9.6 DAL  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        9.6 NO</span></span></code></pre></div>
<p>This mostly checks out.</p>
<p>What if we just used simple point differential to predict?</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#was just a vector, need a tibble to bind</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#make the column name make sense</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#get names</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">team</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">preds2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">prediction</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   prediction team </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       11.2 BAL  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       10.6 NE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       10.3 SF   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        9.9 KC   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        9.6 DAL</span></span></code></pre></div>
<p>Not surprisingly, this looks pretty similar. These are very basic
models that don’t incorporate schedule, roster changes, etc. For
example, a better model would take into account Tom Brady no longer
playing for the Patriots. But hopefully this has been useful!</p>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>You now should know enough to be able to tackle a great deal of
questions using <code>nflfastR</code> data. A good way to build up
skills is to take interesting things you see and try to replicate them
(for making figures, this will also involve a heavy dose of googling
stuff).</p>
<p>Looking at others’ code is also a good way to learn. One option is to
look through the <code>nflfastR</code> code base, much of which you
should now understand what it’s doing. For example, <a href="https://github.com/mrcaseb/nflfastR/blob/master/R/helper_add_nflscrapr_mutations.R" class="external-link">here
is the function that cleans up the data and prepares it for later
stages</a>: there’s a heavy dose of <code>mutate</code>,
<code>group_by</code>, <code>arrange</code>, <code>lag</code>,
<code>if_else</code>, and <code>case_when</code>.</p>
<div class="section level3">
<h3 id="resources-the-gold-standards">Resources: The gold standards<a class="anchor" aria-label="anchor" href="#resources-the-gold-standards"></a>
</h3>
<p>This is an R package so this section is pretty R heavy.</p>
<ul>
<li><a href="https://r4ds.had.co.nz/explore-intro.html" class="external-link">Introduction to
R (<strong>recommended</strong>)</a></li>
<li>
<a href="https://www.opensourcefootball.com/" class="external-link">Open Source
Football</a>: Mix of R and Python</li>
<li>
<a href="https://themockup.blog/" class="external-link">The Mockup Blog (Thomas Mock)</a>:
Invaluable resource for making cool stuff in R</li>
</ul>
</div>
<div class="section level3">
<h3 id="code-examples-r">Code examples: R<a class="anchor" aria-label="anchor" href="#code-examples-r"></a>
</h3>
<ul>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/RSTUDIO-INTRO.md" class="external-link">Lee
Sharpe: basic intro to R and RStudio</a></li>
<li><a href="https://github.com/leesharpe/nfldata" class="external-link">Lee Sharpe: lots of
useful NFL / nflscrapR code</a></li>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/UPDATING-NFLSCRAPR.md" class="external-link">Lee
Sharpe: how to update current season games</a></li>
<li><a href="https://t.co/gxDDhOYhcI" class="external-link">Josh Hermsmeyer: Getting Started
with R for NFL Analysis</a></li>
<li><a href="https://slavin22.github.io/SFB9-Positional-Tiers/Guide.nb" class="external-link">Slavin:
visualizing positional tiers in SFB9</a></li>
<li><a href="https://github.com/ryurko/nflscrapR-data/tree/master/R" class="external-link">Ron
Yurko: assorted examples</a></li>
<li><a href="https://github.com/dhouston890/cowboys-stats/blob/master/playmaking_epa_pbp.R" class="external-link">CowboysStats:
defensive playmaking EPA</a></li>
<li><a href="https://github.com/statsbylopez/BlogPosts/blob/master/scrapr-data.R" class="external-link">Michael
Lopez: function to sample plays</a></li>
<li><a href="https://statsbylopez.netlify.com/post/r-for-nfl-analysis/" class="external-link">Michael
Lopez: R for NFL analysis (presentation to club staffers)</a></li>
<li><a href="https://gist.github.com/wessonmo/45781bd25a74e8097e0c8bc8fbacf796" class="external-link">Mitchell
Wesson: QB hits investigation</a></li>
<li><a href="https://gist.github.com/wessonmo/ef44ea9873d70f816454cb88b86dcce6" class="external-link">Mitchell
Wesson: Investigation of the nflscrapR EP model</a></li>
<li><a href="https://github.com/whoffman21279/Steelers/blob/master/receiving_stats" class="external-link">WHoffman:
graphs for receivers (aDoT, success rate, and more)</a></li>
<li><a href="https://gist.github.com/ChiBearsStats/dac3266037797032a23f38fd9d64d6a8#file-adjustedthirddowns-txt" class="external-link">ChiBearsStats:
investigation of 3rd downs vs offensive efficiency</a></li>
<li><a href="https://gist.github.com/ChiBearsStats/78e33baeed3cd6d3cac0040b47d4ec69" class="external-link">ChiBearsStats:
the insignificance of field goal kicking</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="more-data-sources">More data sources<a class="anchor" aria-label="anchor" href="#more-data-sources"></a>
</h3>
<ul>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/DATASETS.md" class="external-link">Lee
Sharpe: Draft Picks, Draft Values, Games, Logos, Rosters,
Standings</a></li>
<li><a href="https://github.com/greerre/pfr_metadata_pull" class="external-link">greerre: how
to get .csv file of weather &amp; stadium data from PFR in
python</a></li>
<li><a href="https://gist.github.com/spfleming/2527a6ca2b940af2a8aa1fee9320171d" class="external-link">Parker
Fleming: Introduction to College Football Data with R and
cfbscrapR</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="other-code-examples-python">Other code examples: Python<a class="anchor" aria-label="anchor" href="#other-code-examples-python"></a>
</h3>
<ul>
<li><a href="https://gist.github.com/Deryck97/dff8d33e9f841568201a2a0d5519ac5e" class="external-link">Deryck97:
nflfastR Python Guide</a></li>
<li><a href="https://colab.research.google.com/github/nickwan/colab_nflfastR/blob/master/nflfastR_starter.ipynb" class="external-link">Nick
Wan: nflfastR Python Colab Guide</a></li>
<li><a href="https://github.com/jezlax/sports_analytics/blob/master/animated_nfl_scatter.py" class="external-link">Cory
Jez: animated plot</a></li>
<li><a href="https://gist.github.com/903124/6693fdf6b991437a6d6ef9c5d935c83b" class="external-link">903124S:
Sampling EP</a></li>
<li><a href="https://gist.github.com/903124/d304f76688b0699497a35b61b6d1e267" class="external-link">903124S:
estimating EPA using nfldb</a></li>
<li><a href="https://gist.github.com/903124/3c6f0dc0a100d78b8622573ef4c504f5" class="external-link">903124S:
estimate EPA for college football</a></li>
<li>Blake Atkinson: explosiveness <a href="https://medium.com/@BlakeAtkinson/the-2018-kansas-city-chiefs-and-an-explosiveness-metric-in-football-c3b3fd447d73" class="external-link">blog
post</a> and <a href="https://github.com/btatkinson/yard_value/blob/master/yard_value.ipynb" class="external-link">python
code</a>
</li>
<li>Blake Atkinson: player type visualizations <a href="https://medium.com/@BlakeAtkinson/visualizing-different-nfl-player-styles-88ef31420539" class="external-link">blog
post</a> and <a href="https://github.com/btatkinson/player_vectors/blob/master/player_vectors.ipynb" class="external-link">python
code</a>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mrcaseb.com" class="external-link">Sebastian Carl</a>, <a href="https://bsky.app/profile/rbsdm.com" class="external-link">Ben Baldwin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
