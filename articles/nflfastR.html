<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nflfastR">
<title>Get started with nflfastR • nflfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Kanit-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Get started with nflfastR">
<meta property="og:description" content="nflfastR">
<meta property="og:image" content="https://www.nflfastr.com/reference/figures/card.png">
<meta property="og:image:alt" content="nflfastR social preview card">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@nflfastR">
<meta name="twitter:site" content="@nflfastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-8FNRBBEHML"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8FNRBBEHML');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nflfastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.6.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/nflfastR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/beginners_guide.html">A beginner’s guide to nflfastR</a>
    <a class="dropdown-item" href="../articles/field_descriptions.html">Field Descriptions</a>
    <a class="external-link dropdown-item" href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/">nflfastR models</a>
    <a class="external-link dropdown-item" href="https://www.opensourcefootball.com/">Open Source Football</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nflverse/nflfastR-data">
    <span class="fas fa fas fa-database fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://rbsdm.com/stats/">
    <span class="fas fa fas fa-chart-line fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://nflgamedata.com/">
    <span class="fas fa fas fa-football-ball fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/nflfastR">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://discord.com/invite/5Er2FBnnQa">
    <span class="fab fa fab fa-discord fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nflverse/nflfastR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-packages-amp-more">Packages &amp; More</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-packages-amp-more">
    <h6 class="dropdown-header" data-toc-skip>nflverse Packages</h6>
    <a class="dropdown-item" href="https://www.nflfastr.com">nflfastR</a>
    <a class="external-link dropdown-item" href="https://nflseedr.com">nflseedR</a>
    <a class="external-link dropdown-item" href="https://www.nfl4th.com">nfl4th</a>
    <a class="external-link dropdown-item" href="https://nflreadr.nflverse.com/">nflreadr</a>
    <a class="external-link dropdown-item" href="https://nflplotr.nflverse.com/">nflplotR</a>
    <a class="external-link dropdown-item" href="https://nflverse.nflverse.com/">nflverse</a>
    <a class="external-link dropdown-item" href="https://www.opensourcefootball.com">Open Source Football</a>
    <h6 class="dropdown-header" data-toc-skip>nflverse Data</h6>
    <a class="external-link dropdown-item" href="https://github.com/nflverse">nflverse GitHub</a>
    <a class="external-link dropdown-item" href="https://jthomasmock.github.io/espnscrapeR/">espnscrapeR Package</a>
    <h6 class="dropdown-header" data-toc-skip>ffverse</h6>
    <a class="external-link dropdown-item" href="https://www.ffverse.com">ffverse.com</a>
  </div>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Get started with nflfastR</h1>
                        <h4 data-toc-skip class="author">Ben Baldwin
&amp; Sebastian Carl</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nflverse/nflfastR/blob/HEAD/vignettes/nflfastR.Rmd" class="external-link"><code>vignettes/nflfastR.Rmd</code></a></small>
      <div class="d-none name"><code>nflfastR.Rmd</code></div>
    </div>

    
    
<p>If you are new to R or are having trouble understanding the code in
the below sections we highly recommend the <strong>nflfastR beginner’s
guide</strong> in <code><a href="../articles/beginners_guide.html">vignette("beginners_guide")</a></code>.</p>
<div class="section level2">
<h2 id="the-main-functions">The Main Functions<a class="anchor" aria-label="anchor" href="#the-main-functions"></a>
</h2>
<p>nflfastR comes with a set of functions to access NFL play-by-play
data and team rosters. This section provides a brief introduction to the
essential functions.</p>
<p>nflfastR processes and cleans up play-by-play data and adds variables
through <a href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/" class="external-link">it’s
models</a>. Since some of these tasks are performed by separate
functions, the easiest way to compute the complete nflfastR dataset is
<code><a href="../reference/build_nflfastR_pbp.html">build_nflfastR_pbp()</a></code>. The main input for that function is a
set of game ids which can be accessed with
<code><a href="../reference/fast_scraper_schedules.html">fast_scraper_schedules()</a></code>. The following code demonstrates
how to build the nflfastR dataset for the Super Bowls of the 2017 - 2019
seasons.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.nflfastr.com/">nflfastR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper_schedules.html">fast_scraper_schedules</a></span><span class="op">(</span><span class="fl">2017</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">game_type</span> <span class="op">==</span> <span class="st">"SB"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">game_id</span><span class="op">)</span></span>
<span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/build_nflfastR_pbp.html">build_nflfastR_pbp</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Build nflfastR Play-by-Play Data</span> ────────────────── nflfastR version 4.6.1 ──</span></span>
<span><span class="co">#&gt; • 08:24:41 | Start download of 3 games...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:46 | Download finished. Adding variables...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:47 | added game variables</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:47 | added nflscrapR variables</span></span>
<span><span class="co">#&gt; [08:24:47] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:47 | added ep variables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:47 | added air_yac_ep variables</span></span>
<span><span class="co">#&gt; [08:24:47] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [08:24:48] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added wp variables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added air_yac_wp variables</span></span>
<span><span class="co">#&gt; [08:24:48] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added cp and cpoe</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added fixed drive variables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added series variables</span></span>
<span><span class="co">#&gt; • 08:24:48 | Cleaning up play-by-play...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | Cleaning completed</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:48 | added qb_epa</span></span>
<span><span class="co">#&gt; • 08:24:48 | Computing xyac...</span></span>
<span><span class="co">#&gt; [08:24:49] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:51 | added xyac variables</span></span>
<span><span class="co">#&gt; • 08:24:51 | Computing xpass...</span></span>
<span><span class="co">#&gt; [08:24:51] WARNING: src/learner.cc:553: </span></span>
<span><span class="co">#&gt;   If you are loading a serialized model (like pickle in Python, RDS in R) generated by</span></span>
<span><span class="co">#&gt;   older XGBoost, please export the model by calling `Booster.save_model` from that version</span></span>
<span><span class="co">#&gt;   first, then load it back in current version. See:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for more details about differences between saving model and serializing.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:51 | added xpass and pass_oe</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:24:51 | Decoding of player ids completed</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">DONE</span> ────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>In most cases, however, it is not necessary to use this function for
individual games, because nflfastR provides both a <a href="https://github.com/nflverse/nflfastR-data" class="external-link">data repository</a> and
two main play-by-play functions: <code><a href="../reference/load_pbp.html">load_pbp()</a></code> and
<code><a href="../reference/update_db.html">update_db()</a></code>. We cover <code><a href="../reference/load_pbp.html">load_pbp()</a></code> below, and
please see <a href="#example-8-using-the-built-in-database-function">Example 8: Using
the built-in database function</a> for how to work with the database
function <code><a href="../reference/update_db.html">update_db()</a></code>.</p>
<p>The easiest way to access the data in the data repository is the new
function <code><a href="../reference/load_pbp.html">load_pbp()</a></code>. It can load multiple seasons directly
into memory and supports multiple data formats. Loading all play-by-play
data of the 2018-2020 seasons is as easy as</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2018</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<p>Joining roster data to the play-by-play data set is possible as well.
The data can be accessed with the function
<code><a href="../reference/fast_scraper_roster.html">fast_scraper_roster()</a></code> and its application is demonstrated
in <a href="#example-10-working-with-roster-and-position-data">Example
10: Working with roster and position data</a>.</p>
</div>
<div class="section level2">
<h2 id="application-examples">Application Examples<a class="anchor" aria-label="anchor" href="#application-examples"></a>
</h2>
<p>All examples listed below assume that the following two libraries are
installed and loaded.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.nflfastr.com/">nflfastR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-1-replicate-nflscrapr-with-fast_scraper">Example 1: replicate nflscrapR with fast_scraper<a class="anchor" aria-label="anchor" href="#example-1-replicate-nflscrapr-with-fast_scraper"></a>
</h3>
<p>The functionality of <code>nflscrapR</code> can be duplicated by
using <code><a href="../reference/fast_scraper.html">fast_scraper()</a></code>. This obtains the same information
contained in <code>nflscrapR</code> (plus some extra) but much more
quickly. To compare to <code>nflscrapR</code>, we use their data
repository as the program no longer functions now that the NFL has taken
down the old Gamecenter feed. Note that EP differs from nflscrapR as we
use a newer era-adjusted model (more on this in <a href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/" class="external-link">this
post on Open Source Football</a>).</p>
<p>This example also uses the built-in function <code><a href="../reference/clean_pbp.html">clean_pbp()</a></code>
to create a ‘name’ column for the primary player involved (the QB on
pass play or ball-carrier on run play).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/ryurko/nflscrapR-data/blob/master/play_by_play_data/regular_season/reg_pbp_2019.csv?raw=true"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">home_team</span> <span class="op">==</span> <span class="st">"SF"</span> <span class="op">&amp;</span> <span class="va">away_team</span> <span class="op">==</span> <span class="st">"SEA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">desc</span>, <span class="va">play_type</span>, <span class="va">ep</span>, <span class="va">epa</span>, <span class="va">home_wp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="78%">
<col width="6%">
<col width="4%">
<col width="4%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">desc</th>
<th align="left">play_type</th>
<th align="right">ep</th>
<th align="right">epa</th>
<th align="right">home_wp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">J.Myers kicks 65 yards from SEA 35 to end zone,
Touchback.</td>
<td align="left">kickoff</td>
<td align="right">0.815</td>
<td align="right">0.000</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">(15:00) T.Coleman left guard to SF 26 for 1 yard
(J.Clowney).</td>
<td align="left">run</td>
<td align="right">0.815</td>
<td align="right">-0.606</td>
<td align="right">0.500</td>
</tr>
<tr class="odd">
<td align="left">(14:19) T.Coleman right tackle to SF 25 for -1 yards
(P.Ford).</td>
<td align="left">run</td>
<td align="right">0.209</td>
<td align="right">-1.146</td>
<td align="right">0.485</td>
</tr>
<tr class="even">
<td align="left">(13:45) (Shotgun) J.Garoppolo pass short middle to
K.Bourne to SF 41 for 16 yards (J.Taylor). Caught at SF39. 2-yac</td>
<td align="left">pass</td>
<td align="right">-0.937</td>
<td align="right">3.223</td>
<td align="right">0.453</td>
</tr>
<tr class="odd">
<td align="left">(12:58) PENALTY on SEA-J.Reed, Encroachment, 5 yards,
enforced at SF 41 - No Play.</td>
<td align="left">no_play</td>
<td align="right">2.286</td>
<td align="right">0.774</td>
<td align="right">0.551</td>
</tr>
<tr class="even">
<td align="left">(12:38) J.Garoppolo pass incomplete short left to
M.Goodwin [J.Clowney].</td>
<td align="left">pass</td>
<td align="right">3.060</td>
<td align="right">-0.698</td>
<td align="right">0.577</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper.html">fast_scraper</a></span><span class="op">(</span><span class="st">"2019_10_SEA_SF"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/clean_pbp.html">clean_pbp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">desc</span>, <span class="va">play_type</span>, <span class="va">ep</span>, <span class="va">epa</span>, <span class="va">home_wp</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="74%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">desc</th>
<th align="left">play_type</th>
<th align="right">ep</th>
<th align="right">epa</th>
<th align="right">home_wp</th>
<th align="left">name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GAME</td>
<td align="left">NA</td>
<td align="right">1.474</td>
<td align="right">0.000</td>
<td align="right">0.546</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5-J.Myers kicks 65 yards from SEA 35 to end zone,
Touchback.</td>
<td align="left">kickoff</td>
<td align="right">1.474</td>
<td align="right">0.000</td>
<td align="right">0.546</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">(15:00) 26-T.Coleman left guard to SF 26 for 1 yard
(90-J.Clowney).</td>
<td align="left">run</td>
<td align="right">1.474</td>
<td align="right">-0.554</td>
<td align="right">0.546</td>
<td align="left">T.Coleman</td>
</tr>
<tr class="even">
<td align="left">(14:19) 26-T.Coleman right tackle to SF 25 for -1 yards
(97-P.Ford).</td>
<td align="left">run</td>
<td align="right">0.920</td>
<td align="right">-0.814</td>
<td align="right">0.528</td>
<td align="left">T.Coleman</td>
</tr>
<tr class="odd">
<td align="left">(13:45) (Shotgun) 10-J.Garoppolo pass short middle to
84-K.Bourne to SF 41 for 16 yards (24-J.Taylor). Caught at SF39.
2-yac</td>
<td align="left">pass</td>
<td align="right">0.107</td>
<td align="right">2.427</td>
<td align="right">0.498</td>
<td align="left">J.Garoppolo</td>
</tr>
<tr class="even">
<td align="left">(12:58) PENALTY on SEA-91-J.Reed, Encroachment, 5
yards, enforced at SF 41 - No Play.</td>
<td align="left">no_play</td>
<td align="right">2.534</td>
<td align="right">0.600</td>
<td align="right">0.573</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="example-2-scrape-a-batch-of-games-very-quickly-with-fast_scraper">Example 2: scrape a batch of games very quickly with
fast_scraper<a class="anchor" aria-label="anchor" href="#example-2-scrape-a-batch-of-games-very-quickly-with-fast_scraper"></a>
</h3>
<p>This is a demonstration of <code>nflfastR</code>’s capabilities.
While <code>nflfastR</code> can scrape a batch of games very quickly,
<strong>please be respectful of Github’s servers and use the <a href="https://github.com/nflverse/nflfastR-data" class="external-link">data repository</a>
which hosts all the scraped and cleaned data</strong> whenever possible.
The only reason to ever actually use the scraper is if it’s in the
middle of the season and we haven’t updated the repository with recent
games (but it is automatically updated overnight every day).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get list of some games from 2019</span></span>
<span><span class="va">games_2019</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper_schedules.html">fast_scraper_schedules</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">game_id</span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{length(games_2019)} games with nflfastR:"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper.html">fast_scraper</a></span><span class="op">(</span><span class="va">games_2019</span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 10 games with nflfastR:: 8.607 sec elapsed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-completion-percentage-over-expected-cpoe">Example 3: Completion Percentage Over Expected (CPOE)<a class="anchor" aria-label="anchor" href="#example-3-completion-percentage-over-expected-cpoe"></a>
</h3>
<p>Let’s look at CPOE leaders from the 2009 regular season.</p>
<p>As discussed above, <code>nflfastR</code> has a data repository for
old seasons, so there’s no need to actually scrape them. Let’s use that
here with the convenience function <code><a href="../reference/load_pbp.html">load_pbp()</a></code> which fetches
data from the repository (for non-R users, .csv and .parquet are also
available in the <a href="https://github.com/nflverse/nflfastR-data" class="external-link">data
repository</a>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">"loading all games from 2009"</span><span class="op">)</span></span>
<span><span class="va">games_2009</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2009</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; loading all games from 2009: 1.919 sec elapsed</span></span>
<span><span class="va">games_2009</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cpoe</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">passer_player_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cpoe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cpoe</span><span class="op">)</span>, Atts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Atts</span> <span class="op">&gt;</span> <span class="fl">200</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">cpoe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">passer_player_name</th>
<th align="right">cpoe</th>
<th align="right">Atts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Brees</td>
<td align="right">7.5</td>
<td align="right">509</td>
</tr>
<tr class="even">
<td align="left">P.Rivers</td>
<td align="right">6.6</td>
<td align="right">474</td>
</tr>
<tr class="odd">
<td align="left">P.Manning</td>
<td align="right">6.5</td>
<td align="right">569</td>
</tr>
<tr class="even">
<td align="left">B.Favre</td>
<td align="right">6.1</td>
<td align="right">527</td>
</tr>
<tr class="odd">
<td align="left">B.Roethlisberger</td>
<td align="right">5.4</td>
<td align="right">503</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="example-4-using-drive-information">Example 4: Using Drive Information<a class="anchor" aria-label="anchor" href="#example-4-using-drive-information"></a>
</h3>
<p>When working with <code>nflfastR</code>, drive results are
automatically included. We use <code>fixed_drive</code> and
<code>fixed_drive_result</code> since the NFL-provided information is a
bit wonky. Let’s look at how much more likely teams were to score
starting from 1st &amp; 10 at their own 20 yard line in 2015 (the last
year before touchbacks on kickoffs changed to the 25) than in 2000.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2003</span>, <span class="fl">2015</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span> <span class="op">&amp;</span> <span class="va">down</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">ydstogo</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">yardline_100</span> <span class="op">==</span> <span class="fl">80</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>drive_score <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">fixed_drive_result</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Touchdown"</span>, <span class="st">"Field goal"</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>drive_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">drive_score</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">drive_score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2003</td>
<td align="right">0.206</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">0.305</td>
</tr>
</tbody>
</table>
<p>So 20.6% of 1st &amp; 10 plays from teams’ own 20 would see the drive
end up in a score in 2003, compared to 30.5% in 2015. This has
implications for Expected Points models (see <a href="https://www.opensourcefootball.com/posts/2020-09-28-nflfastr-ep-wp-and-cp-models/" class="external-link">this
article</a>).</p>
</div>
<div class="section level3">
<h3 id="example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season">Example 5: Plot offensive and defensive EPA per play for a given
season<a class="anchor" aria-label="anchor" href="#example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season"></a>
</h3>
<p>Let’s build the <strong><a href="https://rbsdm.com/stats/stats/" class="external-link">NFL
team tiers</a></strong> using offensive and defensive expected points
added per play for the 2005 regular season. Creating data viz including
NFL team logos (or wordmarks, or headshots), we recommend the nflverse R
package <a href="https://nflplotr.nflverse.com" class="external-link">nflplotR</a>.</p>
<p>When using <code><a href="../reference/load_pbp.html">load_pbp()</a></code>, the helper function
<code><a href="../reference/clean_pbp.html">clean_pbp()</a></code> has already been run, which creates “rush” and
“pass” columns that (a) properly count sacks and scrambles as pass plays
and (b) properly include plays with penalties. Using this, we can keep
only rush or pass plays.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nflplotr.nflverse.com" class="external-link">nflplotR</a></span><span class="op">)</span></span>
<span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2005</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>off_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">defense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>team <span class="op">=</span> <span class="va">defteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>def_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">offense</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">defense</span>, by <span class="op">=</span> <span class="st">"team"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">off_epa</span>, y <span class="op">=</span> <span class="va">def_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.3</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="op">-</span><span class="fl">.2</span>, <span class="op">-</span><span class="fl">.3</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/geom_lines.html" class="external-link">geom_mean_lines</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">off_epa</span>, x0 <span class="op">=</span> <span class="va">def_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/geom_nfl_logos.html" class="external-link">geom_nfl_logos</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>team_abbr <span class="op">=</span> <span class="va">team</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.07</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Offense EPA/play"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Defense EPA/play"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data: @nflfastR"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"2005 NFL Offensive and Defensive EPA per Play"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="nflfastR_files/figure-html/ex5-1.png" width="4375"></p>
</div>
<div class="section level3">
<h3 id="example-6-expected-points-calculator">Example 6: Expected Points calculator<a class="anchor" aria-label="anchor" href="#example-6-expected-points-calculator"></a>
</h3>
<p>We have provided a calculator for working with the Expected Points
model. Here is an example of how to use it, looking for how the Expected
Points on a drive beginning following a touchback has changed over
time.</p>
<p>While I have put in <code>'SEA'</code> for <code>home_team</code> and
<code>posteam</code>, this only matters for figuring out whether the
team with the ball is the home team (there’s no actual effect for given
team; it would be the same no matter what team is supplied).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">"season"</span> <span class="op">=</span> <span class="fl">1999</span><span class="op">:</span><span class="fl">2019</span>,</span>
<span>  <span class="st">"home_team"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"posteam"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"roof"</span> <span class="op">=</span> <span class="st">"outdoors"</span>,</span>
<span>  <span class="st">"half_seconds_remaining"</span> <span class="op">=</span> <span class="fl">1800</span>,</span>
<span>  <span class="st">"yardline_100"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"down"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"ydstogo"</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  <span class="st">"posteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="st">"defteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_expected_points.html">calculate_expected_points</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">yardline_100</span>, <span class="va">td_prob</span>, <span class="va">ep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">yardline_100</th>
<th align="right">td_prob</th>
<th align="right">ep</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.64</td>
</tr>
<tr class="odd">
<td align="right">2001</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.82</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.82</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.82</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.82</td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="odd">
<td align="right">2007</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">2014</td>
<td align="right">80</td>
<td align="right">0.35</td>
<td align="right">0.98</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="right">80</td>
<td align="right">0.35</td>
<td align="right">0.98</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="right">75</td>
<td align="right">0.38</td>
<td align="right">1.46</td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="right">75</td>
<td align="right">0.38</td>
<td align="right">1.46</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="right">75</td>
<td align="right">0.41</td>
<td align="right">1.47</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="right">75</td>
<td align="right">0.41</td>
<td align="right">1.47</td>
</tr>
</tbody>
</table>
<p>Not surprisingly, offenses have become much more successful over
time, with the kickoff touchback moving from the 20 to the 25 in 2016
providing an additional boost. Note that the <code>td_prob</code> in
this example is the probability that the next score within the same half
will be a touchdown scored by team with the ball, <strong>not</strong>
the probability that the current drive will end in a touchdown (this is
why the numbers are different from Example 4 above).</p>
<p>We could compare the most recent four years to the expectation for
playing in a dome by inputting all the same things and changing the
<code>roof</code> input:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">"season"</span> <span class="op">=</span> <span class="fl">2016</span><span class="op">:</span><span class="fl">2019</span>,</span>
<span>  <span class="st">"week"</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="st">"home_team"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"posteam"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"roof"</span> <span class="op">=</span> <span class="st">"dome"</span>,</span>
<span>  <span class="st">"half_seconds_remaining"</span> <span class="op">=</span> <span class="fl">1800</span>,</span>
<span>  <span class="st">"yardline_100"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"down"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"ydstogo"</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  <span class="st">"posteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="st">"defteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_expected_points.html">calculate_expected_points</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">yardline_100</span>, <span class="va">td_prob</span>, <span class="va">ep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">yardline_100</th>
<th align="right">td_prob</th>
<th align="right">ep</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2016</td>
<td align="right">75</td>
<td align="right">0.41</td>
<td align="right">1.81</td>
</tr>
<tr class="even">
<td align="right">2017</td>
<td align="right">75</td>
<td align="right">0.41</td>
<td align="right">1.81</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="right">75</td>
<td align="right">0.44</td>
<td align="right">1.84</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="right">75</td>
<td align="right">0.44</td>
<td align="right">1.84</td>
</tr>
</tbody>
</table>
<p>So for 2018 and 2019, 1st &amp; 10 from a home team’s own 25 yard
line had higher EP in domes than at home, which is to be expected.</p>
</div>
<div class="section level3">
<h3 id="example-7-win-probability-calculator">Example 7: Win probability calculator<a class="anchor" aria-label="anchor" href="#example-7-win-probability-calculator"></a>
</h3>
<p>We have also provided a calculator for working with the win
probability models. Here is an example of how to use it, looking for how
the win probability to begin the game depends on the pre-game
spread.</p>
<p>While I have put in <code>'SEA'</code> for <code>home_team</code> and
<code>posteam</code>, this only matters for figuring out whether the
team with the ball is the home team (there’s no actual effect for given
team; it would be the same no matter what team is supplied).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">"receive_2h_ko"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="st">"home_team"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"posteam"</span> <span class="op">=</span> <span class="st">"SEA"</span>,</span>
<span>  <span class="st">"score_differential"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="st">"half_seconds_remaining"</span> <span class="op">=</span> <span class="fl">1800</span>,</span>
<span>  <span class="st">"game_seconds_remaining"</span> <span class="op">=</span> <span class="fl">3600</span>,</span>
<span>  <span class="st">"spread_line"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>  <span class="st">"down"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"ydstogo"</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  <span class="st">"yardline_100"</span> <span class="op">=</span> <span class="fl">75</span>,</span>
<span>  <span class="st">"posteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="st">"defteam_timeouts_remaining"</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_win_probability.html">calculate_win_probability</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">spread_line</span>, <span class="va">wp</span>, <span class="va">vegas_wp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">spread_line</th>
<th align="right">wp</th>
<th align="right">vegas_wp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.55</td>
<td align="right">0.51</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">0.55</td>
<td align="right">0.60</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0.55</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">0.55</td>
<td align="right">0.74</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">0.55</td>
<td align="right">0.87</td>
</tr>
</tbody>
</table>
<p>Not surprisingly, <code>vegas_wp</code> increases with the amount a
team was coming into the game favored by.</p>
</div>
<div class="section level3">
<h3 id="example-8-using-the-built-in-database-function">Example 8: Using the built-in database function<a class="anchor" aria-label="anchor" href="#example-8-using-the-built-in-database-function"></a>
</h3>
<p>If you’re comfortable using <code>dplyr</code> functions to
manipulate and tidy data, you’re ready to use a database. Why should you
use a database?</p>
<ul>
<li>The provided function in <code>nflfastR</code> makes it extremely
easy to build a database and keep it updated</li>
<li>Play-by-play data over 20+ seasons takes up a lot of memory: working
with a database allows you to only bring into memory what you actually
need</li>
<li>R makes it <em>extremely</em> easy to work with databases.</li>
</ul>
<div class="section level4">
<h4 id="start-install-and-load-packages">Start: install and load packages<a class="anchor" aria-label="anchor" href="#start-install-and-load-packages"></a>
</h4>
<p>To start, we need to install the two packages required for this that
aren’t installed automatically when <code>nflfastR</code> installs:
<code>DBI</code> and <code>RSQLite</code> (advanced users can use other
types of databases, but this example will use SQLite). The
<code>if</code> statements make sure the packages won’t be updated if
they are already installed:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://dbi.r-dbi.org" class="external-link">"DBI"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"DBI"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://rsqlite.r-dbi.org" class="external-link">"RSQLite"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"RSQLite"</span><span class="op">)</span></span></code></pre></div>
<p>As with always, you only need to install these once. They don’t need
to be loaded to build the database because <code>nflfastR</code> knows
how to use them, but we do need them later on when working with the
database.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="build-database">Build database<a class="anchor" aria-label="anchor" href="#build-database"></a>
</h4>
<p>There’s exactly one function in <code>nflfastR</code> that works with
databases: <code><a href="../reference/update_db.html">update_db()</a></code>. Some notes:</p>
<ul>
<li>If you use <code><a href="../reference/update_db.html">update_db()</a></code> with no arguments, it will build
a SQLite database called <code>pbp_db</code> in your current working
directory, with play-by-play data in a table called
<code>nflfastR_pbp</code>.</li>
<li>You can specify a different directory with <code>dbdir</code>.</li>
<li>You can specify a different filename with <code>dbname</code>.</li>
<li>You can specify a different table name with
<code>tblname</code>.</li>
<li>If you want to rebuild the database from scratch for whatever
reason, supply <code>force_rebuild = TRUE</code>. This is primarily
intended for the case when we update the play-by-play data in the data
repo due to fixing a bug and you want to force the database to be wiped
and updated.</li>
<li>If you want to rebuild specified seasons, this can also be supplied
to <code>force_rebuild</code>
(e.g. <code>force_rebuild = c(2019, 2020)</code>).</li>
<li>The parameter <code>db_connection</code> is intended for advanced
users who want to use other <a href="https://dbi.r-dbi.org/reference/dbidriver-class" class="external-link">DBI drivers</a>,
such as MariaDB, Postgres or odbc. Please note that <code>dbdir</code>
and <code>dbname</code> are dropped when a <code>db_connection</code> is
provided but the argument <code>tblname</code> will still be used to
write the data table into the database.</li>
</ul>
<p>Let’s say I just want to dump a database into the current working
directory. Here we go!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/update_db.html">update_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Update nflfastR Play-by-Play Database</span> ───────────── nflfastR version 4.6.1 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:25:34 | Can't find the data table <span style="color: #0000BB;">"nflfastR_pbp"</span></span></span>
<span><span class="co">#&gt; in your database. Will load the play by play data from</span></span>
<span><span class="co">#&gt; scratch.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • 08:25:34 | Starting download of 25 seasons between 1999 and 2023...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • 08:26:51 | Checking for missing completed games...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:52 | You have 6690 games and are missing 0.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:26:52 | Database update completed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:52 | Path to your db: <span style="color: #0000BB;">./pbp_db</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">DONE</span> ────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>This created a database in the current directory called
<code>pbp_db</code>.</p>
<p>Wait, that’s it? That’s it! What if it’s partway through the season
and you want to make sure all the new games are added to the database?
What do you run? <code><a href="../reference/update_db.html">update_db()</a></code>! (just make sure you’re in the
directory the database is saved in or you supply the right file
path)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/update_db.html">update_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Update nflfastR Play-by-Play Database</span> ───────────── nflfastR version 4.6.1 ──</span></span>
<span><span class="co">#&gt; • 08:26:52 | Checking for missing completed games...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:53 | You have 6690 games and are missing 0.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:26:54 | Database update completed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:54 | Path to your db: <span style="color: #0000BB;">/home/runner/work/nflfastR/nflfastR/vignettes/pbp_db</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">DONE</span> ────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>If it’s partway through a season and you want to re-build a season to
allow for data corrections from the NFL to propagate into your database,
you can specify one season to be rebuilt:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/update_db.html">update_db</a></span><span class="op">(</span>force_rebuild <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Update nflfastR Play-by-Play Database</span> ───────────── nflfastR version 4.6.1 ──</span></span>
<span><span class="co">#&gt; • 08:26:54 | Purging season 2020 from the data table <span style="color: #0000BB;">"nflfastR_pbp"</span> in your</span></span>
<span><span class="co">#&gt; connected database...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • 08:26:54 | Starting download of the 1 season 2020</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • 08:26:57 | Checking for missing completed games...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:58 | You have 6690 games and are missing 0.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 08:26:58 | Database update completed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> 08:26:58 | Path to your db: <span style="color: #0000BB;">/home/runner/work/nflfastR/nflfastR/vignettes/pbp_db</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">DONE</span> ────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="connect-to-database">Connect to database<a class="anchor" aria-label="anchor" href="#connect-to-database"></a>
</h4>
<p>Now we can make a connection to the database. This is the only part
that will look a little bit foreign, but all you need to know is where
your database is located. If it’s in your current working directory,
this will work:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"./pbp_db"</span><span class="op">)</span></span>
<span><span class="va">connection</span></span>
<span><span class="co">#&gt; &lt;SQLiteConnection&gt;</span></span>
<span><span class="co">#&gt;   Path: /home/runner/work/nflfastR/nflfastR/vignettes/pbp_db</span></span>
<span><span class="co">#&gt;   Extensions: TRUE</span></span></code></pre></div>
<p>It looks like nothing happened, but we now have a connection to the
database. Now we’re ready to do stuff. If you aren’t familiar with
databases, they’re organized around tables. Here’s how to see which
tables are present in our database:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "nflfastR_pbp"</span></span></code></pre></div>
<p>Since we went with the defaults, there’s a table called
<code>nflfastR_pbp</code>. Another useful function is to see the fields
(i.e., columns) in a table:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListFields.html" class="external-link">dbListFields</a></span><span class="op">(</span><span class="va">connection</span>, <span class="st">"nflfastR_pbp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "play_id"      "game_id"      "old_game_id"  "home_team"    "away_team"   </span></span>
<span><span class="co">#&gt;  [6] "season_type"  "week"         "posteam"      "posteam_type" "defteam"</span></span></code></pre></div>
<p>This is the same list as the list of columns in <code>nflfastR</code>
play-by-play. Notice we had to supply the name of the table above
(<code>"nflfastR_pbp"</code>).</p>
<p>With all that out of the way, there’s only a couple more things to
learn. The main driver here is <code>tbl</code>, which helps get output
with a specific table in a database:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_db</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">connection</span>, <span class="st">"nflfastR_pbp"</span><span class="op">)</span></span></code></pre></div>
<p>And now, everything will magically just “work”: you can forget you’re
even working with a database!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 2]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.44.2 [/home/runner/work/nflfastR/nflfastR/vignettes/pbp_db]</span></span></span>
<span><span class="co">#&gt;    season     n</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   <span style="text-decoration: underline;">1</span>999 <span style="text-decoration: underline;">46</span>136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   <span style="text-decoration: underline;">2</span>000 <span style="text-decoration: underline;">45</span>492</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   <span style="text-decoration: underline;">2</span>001 <span style="text-decoration: underline;">45</span>694</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   <span style="text-decoration: underline;">2</span>002 <span style="text-decoration: underline;">48</span>085</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   <span style="text-decoration: underline;">2</span>003 <span style="text-decoration: underline;">47</span>602</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   <span style="text-decoration: underline;">2</span>004 <span style="text-decoration: underline;">47</span>470</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   <span style="text-decoration: underline;">2</span>005 <span style="text-decoration: underline;">47</span>611</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   <span style="text-decoration: underline;">2</span>006 <span style="text-decoration: underline;">47</span>134</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   <span style="text-decoration: underline;">2</span>007 <span style="text-decoration: underline;">47</span>056</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   <span style="text-decoration: underline;">2</span>008 <span style="text-decoration: underline;">46</span>712</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">down</span> <span class="op">&lt;=</span> <span class="fl">2</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 2]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.44.2 [/home/runner/work/nflfastR/nflfastR/vignettes/pbp_db]</span></span></span>
<span><span class="co">#&gt;    pass mean_epa</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0  -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1   0.073<span style="text-decoration: underline;">0</span></span></span></code></pre></div>
<p>So far, everything has stayed in the database. If you want to bring a
query into memory, just use <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> at the end:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">russ</span> <span class="op">&lt;-</span> <span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"R.Wilson"</span> <span class="op">&amp;</span> <span class="va">posteam</span> <span class="op">==</span> <span class="st">"SEA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">desc</span>, <span class="va">epa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">russ</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6,944 × 2</span></span></span>
<span><span class="co">#&gt;    desc                                                                      epa</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (14:12) 3-R.Wilson pass short right to 18-S.Rice to SEA 34 for 9 yar…  1.13  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> (12:53) 3-R.Wilson pass incomplete deep left to 18-S.Rice. PENALTY o…  2.68  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> (11:25) (Shotgun) 3-R.Wilson pass incomplete short right to 18-S.Ric… -<span style="color: #BB0000;">1.31</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> (10:24) (Shotgun) 3-R.Wilson pass short left to 18-S.Rice to ARI 31 …  0.928 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> (9:47) 3-R.Wilson scrambles right end ran ob at ARI 27 for 4 yards (… -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> (8:35) 3-R.Wilson pass incomplete short right to 18-S.Rice.           -<span style="color: #BB0000;">0.426</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> (7:54) (Shotgun) 3-R.Wilson left end pushed ob at ARI 9 for 4 yards … -<span style="color: #BB0000;">1.17</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> (:27) 3-R.Wilson sacked at SEA 17 for -5 yards (51-P.Lenon). Penalty… -<span style="color: #BB0000;">1.13</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> (14:28) (Shotgun) 3-R.Wilson pass short right to 17-B.Edwards to SEA…  1.94  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> (13:59) 3-R.Wilson pass incomplete deep left to 87-B.Obomanu.         -<span style="color: #BB0000;">0.453</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6,934 more rows</span></span></span></code></pre></div>
<p>So we’ve searched through about 1 million rows of data across 300+
columns and only brought about 6940 rows and two columns into memory.
Pretty neat! This is how I supply the data to the shiny apps on
rbsdm.com without running out of memory on the server. Now there’s only
one more thing to remember. When you’re finished doing what you need
with the database:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span></code></pre></div>
<p>For more details on using a database with <code>nflfastR</code>, see
<a href="https://themockup.blog/posts/2019-04-28-nflfastr-dbplyr-rsqlite/" class="external-link">Thomas
Mock’s life-changing post here</a>. More detailed information on dbplyr
(the dplyr database back-end) are given in the second edition of <a href="https://r4ds.hadley.nz/import-databases.html" class="external-link">Hadley Wickham’s R
for Data Science (2e)</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-9-working-with-the-expected-yards-after-catch-model">Example 9: working with the expected yards after catch model<a class="anchor" aria-label="anchor" href="#example-9-working-with-the-expected-yards-after-catch-model"></a>
</h3>
<p>The variables in <code>xyac</code> are as follows:</p>
<ul>
<li>
<code>xyac_epa</code>: The expected value of EPA gained after the
catch, <strong>starting from where the catch was made</strong>.</li>
<li>
<code>xyac_success</code>: The probability the play earns positive
EPA (relative to where play started) based on where ball was
caught.</li>
<li>
<code>xyac_fd</code>: Probability play earns a first down based on
where the ball was caught.</li>
<li>
<code>xyac_mean_yardage</code> and <code>xyac_median_yardage</code>:
Average and median expected yards after the catch based on where the
ball was caught.</li>
</ul>
<p>Some other notes:</p>
<ul>
<li>
<code>epa</code> = <code>air_epa</code> + <code>yac_epa</code>,
where <code>air_epa</code> is the EPA associated with a catch at the
target location. If a receiver loses a fumble, it is removed from his
<code>yac_epa</code>
</li>
<li>Expected value of EPA at catch point = <code>air_epa</code> +
<code>xyac_epa</code>
</li>
<li>So if we want to get YAC EPA over expected, we need to compare
<code>yac_epa</code> to <code>xyac_epa</code>, as in the example
below</li>
<li>To get first downs over expected, we could compare
<code>first_down</code> to <code>xyac_fd</code>
</li>
<li>These fields are populated for all pass attempts, whether caught or
not, but restrict to completed passes when measuring, for example, YAC
EPA over expected</li>
<li>The expected YAC EPA model doesn’t take receiver fumbles into
account, so actual minus expected YAC is slightly negative due to
fumbles happening</li>
</ul>
<p>Let’s create measures for EPA and first downs over expected in
2015:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">receiver</span>, <span class="va">receiver_id</span>, <span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tgt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">complete_pass</span> <span class="op">+</span> <span class="va">incomplete_pass</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tgt</span> <span class="op">&gt;=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">complete_pass</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="va">yardline_100</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xyac_epa</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    epa_oe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yac_epa</span> <span class="op">-</span> <span class="va">xyac_epa</span><span class="op">)</span>,</span>
<span>    actual_fd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">first_down</span><span class="op">)</span>,</span>
<span>    expected_fd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xyac_fd</span><span class="op">)</span>,</span>
<span>    fd_oe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">first_down</span> <span class="op">-</span> <span class="va">xyac_fd</span><span class="op">)</span>,</span>
<span>    rec <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">receiver</span>, <span class="va">posteam</span>, <span class="va">actual_fd</span>, <span class="va">expected_fd</span>, <span class="va">fd_oe</span>, <span class="va">epa_oe</span>, <span class="va">rec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">epa_oe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">receiver</th>
<th align="left">posteam</th>
<th align="right">actual_fd</th>
<th align="right">expected_fd</th>
<th align="right">fd_oe</th>
<th align="right">epa_oe</th>
<th align="right">rec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Johnson</td>
<td align="left">ARI</td>
<td align="right">0.500</td>
<td align="right">0.391</td>
<td align="right">0.109</td>
<td align="right">0.334</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">J.White</td>
<td align="left">NE</td>
<td align="right">0.489</td>
<td align="right">0.434</td>
<td align="right">0.055</td>
<td align="right">0.264</td>
<td align="right">47</td>
</tr>
<tr class="odd">
<td align="left">T.Ginn</td>
<td align="left">CAR</td>
<td align="right">0.800</td>
<td align="right">0.734</td>
<td align="right">0.066</td>
<td align="right">0.249</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">D.Lewis</td>
<td align="left">NE</td>
<td align="right">0.472</td>
<td align="right">0.309</td>
<td align="right">0.163</td>
<td align="right">0.238</td>
<td align="right">36</td>
</tr>
<tr class="odd">
<td align="left">L.Green</td>
<td align="left">LAC</td>
<td align="right">0.629</td>
<td align="right">0.526</td>
<td align="right">0.103</td>
<td align="right">0.216</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="left">O.Beckham Jr.</td>
<td align="left">NYG</td>
<td align="right">0.692</td>
<td align="right">0.706</td>
<td align="right">-0.014</td>
<td align="right">0.207</td>
<td align="right">91</td>
</tr>
<tr class="odd">
<td align="left">G.Bernard</td>
<td align="left">CIN</td>
<td align="right">0.373</td>
<td align="right">0.289</td>
<td align="right">0.083</td>
<td align="right">0.204</td>
<td align="right">51</td>
</tr>
<tr class="even">
<td align="left">T.Riddick</td>
<td align="left">DET</td>
<td align="right">0.400</td>
<td align="right">0.304</td>
<td align="right">0.096</td>
<td align="right">0.203</td>
<td align="right">80</td>
</tr>
<tr class="odd">
<td align="left">D.Woodhead</td>
<td align="left">LAC</td>
<td align="right">0.468</td>
<td align="right">0.354</td>
<td align="right">0.114</td>
<td align="right">0.172</td>
<td align="right">77</td>
</tr>
<tr class="even">
<td align="left">T.Lockett</td>
<td align="left">SEA</td>
<td align="right">0.588</td>
<td align="right">0.548</td>
<td align="right">0.040</td>
<td align="right">0.163</td>
<td align="right">51</td>
</tr>
</tbody>
</table>
<p>The presence of so many running backs on this list suggests that even
though it takes into account target depth and pass direction, the model
doesn’t do a great job capturing space. Alternatively, running backs
might be better at generating yards after the catch since running with
the football is their primary role.</p>
</div>
<div class="section level3">
<h3 id="example-10-working-with-roster-and-position-data">Example 10: Working with roster and position data<a class="anchor" aria-label="anchor" href="#example-10-working-with-roster-and-position-data"></a>
</h3>
<p>At long last, there’s a way to merge the new play-by-play data with
roster information. Use the function to get the rosters:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roster</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper_roster.html">fast_scraper_roster</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s load play-by-play data from 2019:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">games_2019</span> <span class="op">&lt;-</span> <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span></span></code></pre></div>
<p>Here is what the player IDs look like because <code>nflfastR</code>
now automatically decodes IDs to look like the old format with GSIS
IDs:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">games_2019</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">posteam</span> <span class="op">==</span> <span class="st">"SEA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-style: italic;">nflverse play by play data</span> ──────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data updated: <span style="color: #00BB00;">2022-09-27 11:19:31 UTC</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,207 × 2</span></span></span>
<span><span class="co">#&gt;    name     id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> C.Carson 00-0033594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> C.Carson 00-0033594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> C.Carson 00-0033594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> C.Carson 00-0033594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> R.Wilson 00-0029263</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,197 more rows</span></span></span></code></pre></div>
<p>Now we’re ready to join to the roster data using these IDs:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">joined</span> <span class="op">&lt;-</span> <span class="va">games_2019</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">receiver_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">season</span>, <span class="va">desc</span>, <span class="va">receiver</span>, <span class="va">receiver_id</span>, <span class="va">epa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">roster</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"receiver_id"</span> <span class="op">=</span> <span class="st">"gsis_id"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the real work is done, this just makes a table and has it look nice</span></span>
<span><span class="va">joined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">position</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WR"</span>, <span class="st">"TE"</span>, <span class="st">"RB"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">receiver_id</span>, <span class="va">receiver</span>, <span class="va">position</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>tot_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">epa</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">tot_epa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>position_rank <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">position_rank</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Pos_Rank <span class="op">=</span> <span class="va">position_rank</span>, Player <span class="op">=</span> <span class="va">receiver</span>, Pos <span class="op">=</span> <span class="va">position</span>, Tgt <span class="op">=</span> <span class="va">n</span>, EPA <span class="op">=</span> <span class="va">tot_epa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Player</span>, <span class="va">Pos</span>, <span class="va">Pos_Rank</span>, <span class="va">Tgt</span>, <span class="va">EPA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Player</th>
<th align="left">Pos</th>
<th align="right">Pos_Rank</th>
<th align="right">Tgt</th>
<th align="right">EPA</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M.Thomas</td>
<td align="left">WR</td>
<td align="right">1</td>
<td align="right">199</td>
<td align="right">105</td>
</tr>
<tr class="even">
<td align="left">T.Kelce</td>
<td align="left">TE</td>
<td align="right">1</td>
<td align="right">179</td>
<td align="right">100</td>
</tr>
<tr class="odd">
<td align="left">C.Godwin</td>
<td align="left">WR</td>
<td align="right">2</td>
<td align="right">123</td>
<td align="right">87</td>
</tr>
<tr class="even">
<td align="left">D.Adams</td>
<td align="left">WR</td>
<td align="right">3</td>
<td align="right">161</td>
<td align="right">77</td>
</tr>
<tr class="odd">
<td align="left">T.Lockett</td>
<td align="left">WR</td>
<td align="right">4</td>
<td align="right">140</td>
<td align="right">76</td>
</tr>
<tr class="even">
<td align="left">J.Jones</td>
<td align="left">WR</td>
<td align="right">5</td>
<td align="right">164</td>
<td align="right">72</td>
</tr>
<tr class="odd">
<td align="left">G.Kittle</td>
<td align="left">TE</td>
<td align="right">2</td>
<td align="right">129</td>
<td align="right">56</td>
</tr>
<tr class="even">
<td align="left">C.McCaffrey</td>
<td align="left">RB</td>
<td align="right">1</td>
<td align="right">148</td>
<td align="right">52</td>
</tr>
<tr class="odd">
<td align="left">D.Waller</td>
<td align="left">TE</td>
<td align="right">3</td>
<td align="right">124</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">A.Ekeler</td>
<td align="left">RB</td>
<td align="right">2</td>
<td align="right">113</td>
<td align="right">44</td>
</tr>
<tr class="odd">
<td align="left">J.Cook</td>
<td align="left">TE</td>
<td align="right">4</td>
<td align="right">75</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="left">Z.Ertz</td>
<td align="left">TE</td>
<td align="right">5</td>
<td align="right">147</td>
<td align="right">42</td>
</tr>
<tr class="odd">
<td align="left">J.White</td>
<td align="left">RB</td>
<td align="right">3</td>
<td align="right">105</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">D.Cook</td>
<td align="left">RB</td>
<td align="right">4</td>
<td align="right">77</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">K.Juszczyk</td>
<td align="left">RB</td>
<td align="right">5</td>
<td align="right">28</td>
<td align="right">23</td>
</tr>
</tbody>
</table>
<p>Not surprisingly, all 5 of the top 5 WRs in terms of EPA added come
in ahead of the top RB. Note that the number of targets won’t match
official stats because we’re including plays with penalties.</p>
</div>
<div class="section level3">
<h3 id="example-11-replicating-official-stats">Example 11: Replicating official stats<a class="anchor" aria-label="anchor" href="#example-11-replicating-official-stats"></a>
</h3>
<p>The columns like <code>name</code>, <code>passer</code>,
<code>fantasy</code> etc are <code>nflfastR</code>-created columns that
mimic “real” football: i.e., excluding plays with spikes, counting
scrambles and sacks as pass plays, etc. But if you’re trying to
replicate official statistics – perhaps for fantasy purposes – use the
<code>*_player_name</code> and <code>*_player_id</code> columns.</p>
<div class="section level4">
<h4 id="leaderboards">Leaderboards<a class="anchor" aria-label="anchor" href="#leaderboards"></a>
</h4>
<p><a href="https://www.nfl.com/stats/player-stats/" class="external-link">Let’s try to
replicate this page of passing leaders</a>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span>, <span class="va">complete_pass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">incomplete_pass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">interception</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">passer_player_name</span>, <span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">passing_yards</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    tds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">touchdown</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">td_team</span> <span class="op">==</span> <span class="va">posteam</span><span class="op">)</span>,</span>
<span>    ints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">interception</span><span class="op">)</span>,</span>
<span>    att <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">passer_player_name</th>
<th align="left">posteam</th>
<th align="right">yards</th>
<th align="right">tds</th>
<th align="right">ints</th>
<th align="right">att</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Watson</td>
<td align="left">HOU</td>
<td align="right">4823</td>
<td align="right">33</td>
<td align="right">7</td>
<td align="right">544</td>
</tr>
<tr class="even">
<td align="left">P.Mahomes</td>
<td align="left">KC</td>
<td align="right">4740</td>
<td align="right">38</td>
<td align="right">6</td>
<td align="right">588</td>
</tr>
<tr class="odd">
<td align="left">T.Brady</td>
<td align="left">TB</td>
<td align="right">4633</td>
<td align="right">40</td>
<td align="right">12</td>
<td align="right">610</td>
</tr>
<tr class="even">
<td align="left">M.Ryan</td>
<td align="left">ATL</td>
<td align="right">4581</td>
<td align="right">26</td>
<td align="right">11</td>
<td align="right">626</td>
</tr>
<tr class="odd">
<td align="left">J.Allen</td>
<td align="left">BUF</td>
<td align="right">4544</td>
<td align="right">37</td>
<td align="right">10</td>
<td align="right">572</td>
</tr>
<tr class="even">
<td align="left">J.Herbert</td>
<td align="left">LAC</td>
<td align="right">4336</td>
<td align="right">31</td>
<td align="right">10</td>
<td align="right">595</td>
</tr>
<tr class="odd">
<td align="left">A.Rodgers</td>
<td align="left">GB</td>
<td align="right">4299</td>
<td align="right">48</td>
<td align="right">5</td>
<td align="right">526</td>
</tr>
<tr class="even">
<td align="left">K.Cousins</td>
<td align="left">MIN</td>
<td align="right">4265</td>
<td align="right">35</td>
<td align="right">13</td>
<td align="right">516</td>
</tr>
<tr class="odd">
<td align="left">R.Wilson</td>
<td align="left">SEA</td>
<td align="right">4212</td>
<td align="right">40</td>
<td align="right">13</td>
<td align="right">558</td>
</tr>
<tr class="even">
<td align="left">P.Rivers</td>
<td align="left">IND</td>
<td align="right">4169</td>
<td align="right">24</td>
<td align="right">11</td>
<td align="right">543</td>
</tr>
</tbody>
</table>
<p>These match the official stats on NFL.com (note the filter for
<code>season_type == "REG"</code> since official stats only count
regular season games). Note that we’re using <code>passing_yards</code>
here because <code>yards_gained</code> is not equal to passing yards on
plays with laterals.</p>
<p>While the above works, we’ve also provided a function that does this
all for you: <code><a href="../reference/calculate_player_stats.html">calculate_player_stats()</a></code>. This function takes
an <code>nflfastR</code> play-by-play dataframe as an input along with
one other argument, <code>weekly</code>, which defaults to
<code>FALSE</code>. When <code>weekly</code> is true, a week-by-week
dataframe is returned (rather than an aggregate over the whole provided
dataframe). Let’s again replicate the top 10 players in passing
yards:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_player_stats.html">calculate_player_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">passing_yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player_name</span>, <span class="va">recent_team</span>, <span class="va">completions</span>, <span class="va">attempts</span>, <span class="va">passing_yards</span>, <span class="va">passing_tds</span>, <span class="va">interceptions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="14%">
<col width="10%">
<col width="16%">
<col width="14%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">player_name</th>
<th align="left">recent_team</th>
<th align="right">completions</th>
<th align="right">attempts</th>
<th align="right">passing_yards</th>
<th align="right">passing_tds</th>
<th align="right">interceptions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Watson</td>
<td align="left">HOU</td>
<td align="right">382</td>
<td align="right">544</td>
<td align="right">4823</td>
<td align="right">33</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">P.Mahomes</td>
<td align="left">KC</td>
<td align="right">390</td>
<td align="right">588</td>
<td align="right">4740</td>
<td align="right">38</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">T.Brady</td>
<td align="left">TB</td>
<td align="right">401</td>
<td align="right">610</td>
<td align="right">4633</td>
<td align="right">40</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">M.Ryan</td>
<td align="left">ATL</td>
<td align="right">407</td>
<td align="right">626</td>
<td align="right">4581</td>
<td align="right">26</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">J.Allen</td>
<td align="left">BUF</td>
<td align="right">396</td>
<td align="right">572</td>
<td align="right">4544</td>
<td align="right">37</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">J.Herbert</td>
<td align="left">LAC</td>
<td align="right">396</td>
<td align="right">595</td>
<td align="right">4336</td>
<td align="right">31</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">A.Rodgers</td>
<td align="left">GB</td>
<td align="right">372</td>
<td align="right">526</td>
<td align="right">4299</td>
<td align="right">48</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">K.Cousins</td>
<td align="left">MIN</td>
<td align="right">349</td>
<td align="right">516</td>
<td align="right">4265</td>
<td align="right">35</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">R.Wilson</td>
<td align="left">SEA</td>
<td align="right">384</td>
<td align="right">558</td>
<td align="right">4212</td>
<td align="right">40</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">P.Rivers</td>
<td align="left">IND</td>
<td align="right">369</td>
<td align="right">543</td>
<td align="right">4169</td>
<td align="right">24</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
<p>We can do the same for rush attempts to replicate the <a href="https://www.nfl.com/stats/player-stats/category/rushing/2020/POST/all/rushingyards/desc" class="external-link">NFL
leaderboard</a>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_player_stats.html">calculate_player_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">rushing_yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player_name</span>, <span class="va">recent_team</span>, <span class="va">carries</span>, <span class="va">rushing_yards</span>, <span class="va">rushing_tds</span>, <span class="va">rushing_fumbles_lost</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="15%">
<col width="10%">
<col width="17%">
<col width="15%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="left">player_name</th>
<th align="left">recent_team</th>
<th align="right">carries</th>
<th align="right">rushing_yards</th>
<th align="right">rushing_tds</th>
<th align="right">rushing_fumbles_lost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Henry</td>
<td align="left">TEN</td>
<td align="right">378</td>
<td align="right">2027</td>
<td align="right">17</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">D.Cook</td>
<td align="left">MIN</td>
<td align="right">312</td>
<td align="right">1557</td>
<td align="right">16</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">J.Taylor</td>
<td align="left">IND</td>
<td align="right">232</td>
<td align="right">1169</td>
<td align="right">11</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">A.Jones</td>
<td align="left">GB</td>
<td align="right">201</td>
<td align="right">1104</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">D.Montgomery</td>
<td align="left">CHI</td>
<td align="right">247</td>
<td align="right">1070</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">J.Robinson</td>
<td align="left">JAX</td>
<td align="right">240</td>
<td align="right">1070</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">N.Chubb</td>
<td align="left">CLE</td>
<td align="right">190</td>
<td align="right">1067</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">J.Jacobs</td>
<td align="left">LV</td>
<td align="right">273</td>
<td align="right">1065</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">L.Jackson</td>
<td align="left">BAL</td>
<td align="right">159</td>
<td align="right">1005</td>
<td align="right">7</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">M.Gordon</td>
<td align="left">DEN</td>
<td align="right">215</td>
<td align="right">986</td>
<td align="right">9</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>Again, this matches up exactly.</p>
</div>
<div class="section level4">
<h4 id="yards-from-scrimmage">Yards from scrimmage<a class="anchor" aria-label="anchor" href="#yards-from-scrimmage"></a>
</h4>
<p>What if we want total yards from scrimmage? We’ll demonstrate three
methods here. The hardest way is to use the
<code>fantasy_player_name</code> column, which is the rusher on rush
plays and receiver on receiving plays:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">fantasy_player_name</span>, <span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    carries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rush_attempt</span><span class="op">)</span>,</span>
<span>    receptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">complete_pass</span><span class="op">)</span>,</span>
<span>    touches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rush_attempt</span> <span class="op">+</span> <span class="va">complete_pass</span><span class="op">)</span>,</span>
<span>    yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">yards_gained</span><span class="op">)</span>,</span>
<span>    tds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">touchdown</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">td_team</span> <span class="op">==</span> <span class="va">posteam</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="30%">
<col width="12%">
<col width="12%">
<col width="16%">
<col width="12%">
<col width="9%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">fantasy_player_name</th>
<th align="left">posteam</th>
<th align="right">carries</th>
<th align="right">receptions</th>
<th align="right">touches</th>
<th align="right">yards</th>
<th align="right">tds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Henry</td>
<td align="left">TEN</td>
<td align="right">378</td>
<td align="right">19</td>
<td align="right">397</td>
<td align="right">2141</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">D.Cook</td>
<td align="left">MIN</td>
<td align="right">312</td>
<td align="right">44</td>
<td align="right">356</td>
<td align="right">1918</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">A.Kamara</td>
<td align="left">NO</td>
<td align="right">187</td>
<td align="right">83</td>
<td align="right">270</td>
<td align="right">1688</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">S.Diggs</td>
<td align="left">BUF</td>
<td align="right">1</td>
<td align="right">127</td>
<td align="right">128</td>
<td align="right">1536</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">D.Montgomery</td>
<td align="left">CHI</td>
<td align="right">247</td>
<td align="right">54</td>
<td align="right">301</td>
<td align="right">1508</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">J.Taylor</td>
<td align="left">IND</td>
<td align="right">232</td>
<td align="right">36</td>
<td align="right">268</td>
<td align="right">1468</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">A.Jones</td>
<td align="left">GB</td>
<td align="right">201</td>
<td align="right">47</td>
<td align="right">248</td>
<td align="right">1459</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">T.Kelce</td>
<td align="left">KC</td>
<td align="right">0</td>
<td align="right">105</td>
<td align="right">105</td>
<td align="right">1416</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">J.Robinson</td>
<td align="left">JAX</td>
<td align="right">240</td>
<td align="right">49</td>
<td align="right">289</td>
<td align="right">1414</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">D.Hopkins</td>
<td align="left">ARI</td>
<td align="right">1</td>
<td align="right">115</td>
<td align="right">116</td>
<td align="right">1408</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Looking at the <a href="https://www.pro-football-reference.com/years/2020/scrimmage.htm" class="external-link">PFR
scrimmage stats</a>, these columns are an exact match.</p>
<p>But we could also just use <code><a href="../reference/calculate_player_stats.html">calculate_player_stats()</a></code>
again:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_player_stats.html">calculate_player_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    yards <span class="op">=</span> <span class="va">rushing_yards</span> <span class="op">+</span> <span class="va">receiving_yards</span>, </span>
<span>    touches <span class="op">=</span> <span class="va">carries</span> <span class="op">+</span> <span class="va">receptions</span>, </span>
<span>    tds <span class="op">=</span> <span class="va">rushing_tds</span> <span class="op">+</span> <span class="va">receiving_tds</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player_name</span>, <span class="va">recent_team</span>, <span class="va">carries</span>, <span class="va">receptions</span>, <span class="va">touches</span>, <span class="va">yards</span>, <span class="va">tds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">player_name</th>
<th align="left">recent_team</th>
<th align="right">carries</th>
<th align="right">receptions</th>
<th align="right">touches</th>
<th align="right">yards</th>
<th align="right">tds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Henry</td>
<td align="left">TEN</td>
<td align="right">378</td>
<td align="right">19</td>
<td align="right">397</td>
<td align="right">2141</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">D.Cook</td>
<td align="left">MIN</td>
<td align="right">312</td>
<td align="right">44</td>
<td align="right">356</td>
<td align="right">1918</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">A.Kamara</td>
<td align="left">NO</td>
<td align="right">187</td>
<td align="right">83</td>
<td align="right">270</td>
<td align="right">1688</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">S.Diggs</td>
<td align="left">BUF</td>
<td align="right">1</td>
<td align="right">127</td>
<td align="right">128</td>
<td align="right">1536</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">D.Montgomery</td>
<td align="left">CHI</td>
<td align="right">247</td>
<td align="right">54</td>
<td align="right">301</td>
<td align="right">1508</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">J.Taylor</td>
<td align="left">IND</td>
<td align="right">232</td>
<td align="right">36</td>
<td align="right">268</td>
<td align="right">1468</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">A.Jones</td>
<td align="left">GB</td>
<td align="right">201</td>
<td align="right">47</td>
<td align="right">248</td>
<td align="right">1459</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">T.Kelce</td>
<td align="left">KC</td>
<td align="right">0</td>
<td align="right">105</td>
<td align="right">105</td>
<td align="right">1416</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">J.Robinson</td>
<td align="left">JAX</td>
<td align="right">240</td>
<td align="right">49</td>
<td align="right">289</td>
<td align="right">1414</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">D.Hopkins</td>
<td align="left">ARI</td>
<td align="right">1</td>
<td align="right">115</td>
<td align="right">116</td>
<td align="right">1408</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>And we get the same thing.</p>
<p>The third way is to use the <code><a href="../reference/load_player_stats.html">load_player_stats()</a></code>
function, which can load a data frame of player-level stats for every
week since 1999.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_player_stats.html">load_player_stats</a></span><span class="op">(</span>seasons <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">player_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    player_name <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">player_name</span><span class="op">)</span>,</span>
<span>    recent_team <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">recent_team</span><span class="op">)</span>,</span>
<span>    yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rushing_yards</span> <span class="op">+</span> <span class="va">receiving_yards</span><span class="op">)</span>,</span>
<span>    touches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">carries</span> <span class="op">+</span> <span class="va">receptions</span><span class="op">)</span>,</span>
<span>    carries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">carries</span><span class="op">)</span>,</span>
<span>    receptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">receptions</span><span class="op">)</span>,</span>
<span>    tds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rushing_tds</span> <span class="op">+</span> <span class="va">receiving_tds</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player_name</span>, <span class="va">recent_team</span>, <span class="va">carries</span>, <span class="va">receptions</span>, <span class="va">touches</span>, <span class="va">yards</span>, <span class="va">tds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">player_name</th>
<th align="left">recent_team</th>
<th align="right">carries</th>
<th align="right">receptions</th>
<th align="right">touches</th>
<th align="right">yards</th>
<th align="right">tds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Henry</td>
<td align="left">TEN</td>
<td align="right">378</td>
<td align="right">19</td>
<td align="right">397</td>
<td align="right">2141</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">D.Cook</td>
<td align="left">MIN</td>
<td align="right">312</td>
<td align="right">44</td>
<td align="right">356</td>
<td align="right">1918</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">A.Kamara</td>
<td align="left">NO</td>
<td align="right">187</td>
<td align="right">83</td>
<td align="right">270</td>
<td align="right">1688</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">S.Diggs</td>
<td align="left">BUF</td>
<td align="right">1</td>
<td align="right">127</td>
<td align="right">128</td>
<td align="right">1536</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">D.Montgomery</td>
<td align="left">CHI</td>
<td align="right">247</td>
<td align="right">54</td>
<td align="right">301</td>
<td align="right">1508</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">J.Taylor</td>
<td align="left">IND</td>
<td align="right">232</td>
<td align="right">36</td>
<td align="right">268</td>
<td align="right">1468</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">A.Jones</td>
<td align="left">GB</td>
<td align="right">201</td>
<td align="right">47</td>
<td align="right">248</td>
<td align="right">1459</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">T.Kelce</td>
<td align="left">KC</td>
<td align="right">0</td>
<td align="right">105</td>
<td align="right">105</td>
<td align="right">1416</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">J.Robinson</td>
<td align="left">JAX</td>
<td align="right">240</td>
<td align="right">49</td>
<td align="right">289</td>
<td align="right">1414</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">D.Hopkins</td>
<td align="left">ARI</td>
<td align="right">1</td>
<td align="right">115</td>
<td align="right">116</td>
<td align="right">1408</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>And again the output is identical.</p>
</div>
<div class="section level4">
<h4 id="fantasy-points">Fantasy points<a class="anchor" aria-label="anchor" href="#fantasy-points"></a>
</h4>
<p>Let’s calculate PPR fantasy points per game in the first 16 weeks of
the season among wide receivers who appeared in more than 5 games.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">week</span> <span class="op">&lt;=</span> <span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_player_stats.html">calculate_player_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ppg <span class="op">=</span> <span class="va">fantasy_points_ppr</span> <span class="op">/</span> <span class="va">games</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">games</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># only keep the WRs</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/fast_scraper_roster.html">fast_scraper_roster</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">position</span> <span class="op">==</span> <span class="st">"WR"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>player_id <span class="op">=</span> <span class="va">gsis_id</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"player_id"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">ppg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player_name</span>, <span class="va">recent_team</span>, <span class="va">games</span>, <span class="va">fantasy_points_ppr</span>, <span class="va">ppg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">player_name</th>
<th align="left">recent_team</th>
<th align="right">games</th>
<th align="right">fantasy_points_ppr</th>
<th align="right">ppg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Adams</td>
<td align="left">GB</td>
<td align="right">13</td>
<td align="right">341.8</td>
<td align="right">26.3</td>
</tr>
<tr class="even">
<td align="left">T.Hill</td>
<td align="left">KC</td>
<td align="right">15</td>
<td align="right">328.9</td>
<td align="right">21.9</td>
</tr>
<tr class="odd">
<td align="left">S.Diggs</td>
<td align="left">BUF</td>
<td align="right">15</td>
<td align="right">314.0</td>
<td align="right">20.9</td>
</tr>
<tr class="even">
<td align="left">C.Ridley</td>
<td align="left">ATL</td>
<td align="right">14</td>
<td align="right">270.9</td>
<td align="right">19.3</td>
</tr>
<tr class="odd">
<td align="left">D.Hopkins</td>
<td align="left">ARI</td>
<td align="right">15</td>
<td align="right">280.3</td>
<td align="right">18.7</td>
</tr>
<tr class="even">
<td align="left">D.Metcalf</td>
<td align="left">SEA</td>
<td align="right">15</td>
<td align="right">268.2</td>
<td align="right">17.9</td>
</tr>
<tr class="odd">
<td align="left">K.Allen</td>
<td align="left">LAC</td>
<td align="right">14</td>
<td align="right">245.1</td>
<td align="right">17.5</td>
</tr>
<tr class="even">
<td align="left">A.Thielen</td>
<td align="left">MIN</td>
<td align="right">14</td>
<td align="right">244.3</td>
<td align="right">17.4</td>
</tr>
<tr class="odd">
<td align="left">W.Fuller</td>
<td align="left">HOU</td>
<td align="right">11</td>
<td align="right">188.9</td>
<td align="right">17.2</td>
</tr>
<tr class="even">
<td align="left">A.Robinson</td>
<td align="left">CHI</td>
<td align="right">15</td>
<td align="right">257.2</td>
<td align="right">17.1</td>
</tr>
</tbody>
</table>
<p>Comparing to <a href="https://www.fantasypros.com/nfl/reports/leaders/ppr-wr.php?year=2020&amp;start=1&amp;end=16" class="external-link">the
FantasyPros website</a>, this is an exact match.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="frequent-issues">Frequent issues<a class="anchor" aria-label="anchor" href="#frequent-issues"></a>
</h2>
<div class="section level3">
<h3 id="the-drive-column-looks-wacky">The <code>drive</code> column looks wacky<a class="anchor" aria-label="anchor" href="#the-drive-column-looks-wacky"></a>
</h3>
<p>Use <code>fixed_drive</code> and <code>fixed_drive_result</code>
instead. See <a href="#example-4-using-drive-information">Example 4:
Using Drive Information</a>.</p>
</div>
<div class="section level3">
<h3 id="why-are-there-so-many-win-probability-columns">Why are there so many win probability columns?<a class="anchor" aria-label="anchor" href="#why-are-there-so-many-win-probability-columns"></a>
</h3>
<p><code>vegas_wp</code> and <code>vegas_home_wp</code> incorporate the
pregame spread and are much better models.</p>
</div>
<div class="section level3">
<h3 id="im-trying-to-do-x--help">I’m trying to do X. Help!<a class="anchor" aria-label="anchor" href="#im-trying-to-do-x--help"></a>
</h3>
<p>Please ask <a href="https://discord.com/invite/5Er2FBnnQa" class="external-link">in the
Discord channel</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="links">Links<a class="anchor" aria-label="anchor" href="#links"></a>
</h2>
<p>This section is a helper that holds the hyperlinks to the above
chapters. It’s a workaround for the missing sections anchor bug in
pkgdown which will hopefully be fixed with <a href="https://github.com/r-lib/pkgdown/pull/1536" class="external-link">this pull request</a>
at some point in the future.</p>
<ul>
<li><a href="#the-main-functions">The Main Functions</a></li>
<li><a href="#example-1-replicate-nflscrapr-with-fast_scraper">Example
1: replicate nflscrapR with fast_scraper</a></li>
<li><a href="#example-2-scrape-a-batch-of-games-very-quickly-with-fast_scraper">Example
2: scrape a batch of games very quickly with fast_scraper</a></li>
<li><a href="#example-3-completion-percentage-over-expected-cpoe">Example 3:
Completion Percentage Over Expected (CPOE)</a></li>
<li><a href="#example-4-using-drive-information">Example 4: Using Drive
Information</a></li>
<li><a href="#example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season">Example
5: Plot offensive and defensive EPA per play for a given season</a></li>
<li><a href="#example-6-expected-points-calculator">Example 6: Expected
Points calculator</a></li>
<li><a href="#example-7-win-probability-calculator">Example 7: Win
probability calculator</a></li>
<li><a href="#example-8-using-the-built-in-database-function">Example 8:
Using the built-in database function</a></li>
<li><a href="#example-9-working-with-the-expected-yards-after-catch-model">Example
9: working with the expected yards after catch model</a></li>
<li><a href="#example-10-working-with-roster-and-position-data">Example
10: Working with roster and position data</a></li>
<li><a href="#example-11-replicating-official-stats">Example 11:
Replicating official stats</a></li>
<li><a href="#frequent-issues">Frequent issues</a></li>
<li><a href="#links">Links</a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://twitter.com/mrcaseb" class="external-link">Sebastian Carl</a>, <a href="https://twitter.com/benbbaldwin" class="external-link">Ben Baldwin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
