<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples • nflfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
<meta property="og:description" content="nflfastR">
<meta property="og:image" content="https://raw.githubusercontent.com/mrcaseb/nflfastR/master/man/figures/card.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@nflfastR">
<meta name="twitter:site" content="@nflfastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nflfastR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/beginners_guide.html">A beginner's guide to nflfastR</a>
    </li>
    <li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/nflfastR-models.html">nflfastR EP, WP, and CP models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://twitter.com/nflfastR">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/mrcaseb/nflfastR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="examples_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples</h1>
                        <h4 class="author">Ben Baldwin &amp; Sebastian Carl</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrcaseb/nflfastR/blob/master/vignettes/examples.Rmd"><code>vignettes/examples.Rmd</code></a></small>
      <div class="hidden name"><code>examples.Rmd</code></div>

    </div>

    
    
<p>All examples listed below assume that the following two libraries are installed and loaded.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://mrcaseb.github.io/nflfastR">nflfastR</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span>)
</pre></div>
<p>If you have trouble understanding the code in the examples we highly recommend the <strong>nflfastR beginner’s guide</strong> in <code><a href="../articles/beginners_guide.html">vignette("beginners_guide")</a></code>.</p>
<div id="example-1-replicate-nflscrapr-with-fast_scraper" class="section level1">
<h1 class="hasAnchor">
<a href="#example-1-replicate-nflscrapr-with-fast_scraper" class="anchor"></a>Example 1: replicate nflscrapR with fast_scraper</h1>
<p>The functionality of <code>nflscrapR</code> can be duplicated by using <code><a href="../reference/fast_scraper.html">fast_scraper()</a></code>. This obtains the same information contained in <code>nflscrapR</code> (plus some extra) but much more quickly. To compare to <code>nflscrapR</code>, we use their data repository as the program no longer functions now that the NFL has taken down the old Gamecenter feed. Note that EP differs from nflscrapR as we use a newer era-adjusted model (more on this in <code><a href="../articles/nflfastR-models.html">vignette("nflfastR-models")</a></code>).</p>
<p>This example also uses the built-in function <code><a href="../reference/clean_pbp.html">clean_pbp()</a></code> to create a ‘name’ column for the primary player involved (the QB on pass play or ball-carrier on run play).</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu">read_csv</span>(<span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(<span class="st">'https://github.com/ryurko/nflscrapR-data/blob/master/play_by_play_data/regular_season/reg_pbp_2019.csv?raw=true'</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">home_team</span> <span class="op">==</span> <span class="st">'SF'</span> <span class="op">&amp;</span> <span class="kw">away_team</span> <span class="op">==</span> <span class="st">'SEA'</span>) <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">desc</span>, <span class="kw">play_type</span>, <span class="kw">ep</span>, <span class="kw">epa</span>, <span class="kw">home_wp</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">5</span>) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">3</span>)
</pre></div>
<table class="table">
<colgroup>
<col width="78%">
<col width="6%">
<col width="4%">
<col width="4%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">desc</th>
<th align="left">play_type</th>
<th align="right">ep</th>
<th align="right">epa</th>
<th align="right">home_wp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">J.Myers kicks 65 yards from SEA 35 to end zone, Touchback.</td>
<td align="left">kickoff</td>
<td align="right">0.815</td>
<td align="right">0.000</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">(15:00) T.Coleman left guard to SF 26 for 1 yard (J.Clowney).</td>
<td align="left">run</td>
<td align="right">0.815</td>
<td align="right">-0.606</td>
<td align="right">0.500</td>
</tr>
<tr class="odd">
<td align="left">(14:19) T.Coleman right tackle to SF 25 for -1 yards (P.Ford).</td>
<td align="left">run</td>
<td align="right">0.209</td>
<td align="right">-1.146</td>
<td align="right">0.485</td>
</tr>
<tr class="even">
<td align="left">(13:45) (Shotgun) J.Garoppolo pass short middle to K.Bourne to SF 41 for 16 yards (J.Taylor). Caught at SF39. 2-yac</td>
<td align="left">pass</td>
<td align="right">-0.937</td>
<td align="right">3.223</td>
<td align="right">0.453</td>
</tr>
<tr class="odd">
<td align="left">(12:58) PENALTY on SEA-J.Reed, Encroachment, 5 yards, enforced at SF 41 - No Play.</td>
<td align="left">no_play</td>
<td align="right">2.286</td>
<td align="right">0.774</td>
<td align="right">0.551</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="../reference/fast_scraper.html">fast_scraper</a></span>(<span class="st">'2019_10_SEA_SF'</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/clean_pbp.html">clean_pbp</a></span>() <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">desc</span>, <span class="kw">play_type</span>, <span class="kw">ep</span>, <span class="kw">epa</span>, <span class="kw">home_wp</span>, <span class="kw">name</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">6</span>) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">3</span>)
</pre></div>
<table class="table">
<colgroup>
<col width="74%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">desc</th>
<th align="left">play_type</th>
<th align="right">ep</th>
<th align="right">epa</th>
<th align="right">home_wp</th>
<th align="left">name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GAME</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5-J.Myers kicks 65 yards from SEA 35 to end zone, Touchback.</td>
<td align="left">kickoff</td>
<td align="right">1.500</td>
<td align="right">0.000</td>
<td align="right">0.560</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">(15:00) 26-T.Coleman left guard to SF 26 for 1 yard (90-J.Clowney).</td>
<td align="left">run</td>
<td align="right">1.500</td>
<td align="right">-0.528</td>
<td align="right">0.560</td>
<td align="left">T.Coleman</td>
</tr>
<tr class="even">
<td align="left">(14:19) 26-T.Coleman right tackle to SF 25 for -1 yards (97-P.Ford).</td>
<td align="left">run</td>
<td align="right">0.972</td>
<td align="right">-0.746</td>
<td align="right">0.546</td>
<td align="left">T.Coleman</td>
</tr>
<tr class="odd">
<td align="left">(13:45) (Shotgun) 10-J.Garoppolo pass short middle to 84-K.Bourne to SF 41 for 16 yards (24-J.Taylor). Caught at SF39. 2-yac</td>
<td align="left">pass</td>
<td align="right">0.225</td>
<td align="right">2.240</td>
<td align="right">0.524</td>
<td align="left">J.Garoppolo</td>
</tr>
<tr class="even">
<td align="left">(12:58) PENALTY on SEA-91-J.Reed, Encroachment, 5 yards, enforced at SF 41 - No Play.</td>
<td align="left">no_play</td>
<td align="right">2.465</td>
<td align="right">0.801</td>
<td align="right">0.590</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="example-2-scrape-a-batch-of-games-very-quickly-with-fast_scraper-and-parallel-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#example-2-scrape-a-batch-of-games-very-quickly-with-fast_scraper-and-parallel-processing" class="anchor"></a>Example 2: scrape a batch of games very quickly with fast_scraper and parallel processing</h1>
<p>This is a demonstration of <code>nflfastR</code>’s capabilities. While <code>nflfastR</code> can scrape a batch of games very quickly, <strong>please be respectful of Github’s servers and use the <a href="https://github.com/guga31bb/nflfastR-data">data repository</a> which hosts all the scraped and cleaned data</strong> whenever possible. The only reason to ever actually use the scraper is if it’s in the middle of the season and we haven’t updated the repository with recent games (but we will try to keep it updated).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co">#get list of some games from 2019</span>
<span class="kw">games_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fast_scraper_schedules.html">fast_scraper_schedules</a></span>(<span class="fl">2019</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">10</span>) <span class="op">%&gt;%</span> <span class="fu">pull</span>(<span class="kw">game_id</span>)

<span class="kw">tictoc</span>::<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span>(<span class="kw">glue</span>::<span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="st">'{length(games_2019)} games with nflfastR:'</span>))
<span class="kw">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fast_scraper.html">fast_scraper</a></span>(<span class="kw">games_2019</span>, pp = <span class="fl">TRUE</span>)
<span class="kw">tictoc</span>::<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span>()
<span class="co">#&gt; 10 games with nflfastR:: 16.97 sec elapsed</span>
</pre></div>
</div>
<div id="example-3-completion-percentage-over-expected-cpoe" class="section level1">
<h1 class="hasAnchor">
<a href="#example-3-completion-percentage-over-expected-cpoe" class="anchor"></a>Example 3: completion percentage over expected (CPOE)</h1>
<p>Let’s look at CPOE leaders from the 2009 regular season.</p>
<p>As discussed above, <code>nflfastR</code> has a data repository for old seasons, so there’s no need to actually scrape them. Let’s use that here (the below reads .rds files, but .csv and .parquet are also available).</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">tictoc</span>::<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span>(<span class="st">'loading all games from 2009'</span>)
<span class="kw">games_2009</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(<span class="st">'https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2009.rds'</span>)) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">season_type</span> <span class="op">==</span> <span class="st">'REG'</span>)
<span class="kw">tictoc</span>::<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span>()
<span class="co">#&gt; loading all games from 2009: 3.516 sec elapsed</span>
<span class="kw">games_2009</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">cpoe</span>)) <span class="op">%&gt;%</span> <span class="fu">group_by</span>(<span class="kw">passer_player_name</span>) <span class="op">%&gt;%</span>
  <span class="fu">summarize</span>(cpoe = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">cpoe</span>), Atts=<span class="fu">n</span>()) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">Atts</span> <span class="op">&gt;</span> <span class="fl">200</span>) <span class="op">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="op">-</span><span class="kw">cpoe</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">5</span>) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">1</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">passer_player_name</th>
<th align="right">cpoe</th>
<th align="right">Atts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">D.Brees</td>
<td align="right">7.4</td>
<td align="right">509</td>
</tr>
<tr class="even">
<td align="left">P.Manning</td>
<td align="right">6.6</td>
<td align="right">569</td>
</tr>
<tr class="odd">
<td align="left">P.Rivers</td>
<td align="right">6.4</td>
<td align="right">474</td>
</tr>
<tr class="even">
<td align="left">B.Favre</td>
<td align="right">6.2</td>
<td align="right">527</td>
</tr>
<tr class="odd">
<td align="left">B.Roethlisberger</td>
<td align="right">5.3</td>
<td align="right">503</td>
</tr>
</tbody>
</table>
</div>
<div id="example-4-using-drive-information" class="section level1">
<h1 class="hasAnchor">
<a href="#example-4-using-drive-information" class="anchor"></a>Example 4: using drive information</h1>
<p>When working with <code>nflfastR</code>, drive results are automatically included. Let’s look at how much more likely teams were to score starting from 1st &amp; 10 at their own 20 yard line in 2015 (the last year before touchbacks on kickoffs changed to the 25) than in 2000.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">games_2000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(<span class="st">'https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2000.rds'</span>))
<span class="kw">games_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(<span class="st">'https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2015.rds'</span>))

<span class="kw">pbp</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span>(<span class="kw">games_2000</span>, <span class="kw">games_2015</span>)

<span class="kw">pbp</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">season_type</span> <span class="op">==</span> <span class="st">'REG'</span> <span class="op">&amp;</span> <span class="kw">down</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="kw">ydstogo</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="kw">yardline_100</span> <span class="op">==</span> <span class="fl">80</span>) <span class="op">%&gt;%</span>
  <span class="fu">mutate</span>(drive_score = <span class="fu">if_else</span>(<span class="kw">drive_end_transition</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Touchdown"</span>, <span class="st">"Field Goal"</span>, <span class="st">"TOUCHDOWN"</span>, <span class="st">"FIELD_GOAL"</span>), <span class="fl">1</span>, <span class="fl">0</span>)) <span class="op">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="kw">season</span>) <span class="op">%&gt;%</span>
  <span class="fu">summarize</span>(drive_score = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">drive_score</span>)) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">3</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">drive_score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2000</td>
<td align="right">0.234</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">0.305</td>
</tr>
</tbody>
</table>
<p>So about 23% of 1st &amp; 10 plays from teams’ own 20 would see the drive end up in a score in 2000, compared to 30% in 2015. This has implications for Expected Points models (see <code><a href="../articles/nflfastR-models.html">vignette("nflfastR-models")</a></code>).</p>
</div>
<div id="example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season" class="section level1">
<h1 class="hasAnchor">
<a href="#example-5-plot-offensive-and-defensive-epa-per-play-for-a-given-season" class="anchor"></a>Example 5: Plot offensive and defensive EPA per play for a given season</h1>
<p>Let’s build the <strong><a href="https://rbsdm.com/stats/stats/">NFL team tiers</a></strong> using offensive and defensive expected points added per play for the 2005 regular season. The logo urls of the espn logos are integrated into the <code><a href="../reference/teams_colors_logos.html">?teams_colors_logos</a></code> data frame which is delivered with the package.</p>
<p>Let’s also use the included helper function <code><a href="../reference/clean_pbp.html">clean_pbp()</a></code>, which creates “rush” and “pass” columns that (a) properly count sacks and scrambles as pass plays and (b) properly include plays with penalties. Using this, we can keep only rush or pass plays.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/GuangchuangYu/ggimage">ggimage</a></span>)
<span class="kw">pbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(<span class="st">'https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2005.rds'</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">season_type</span> <span class="op">==</span> <span class="st">'REG'</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">posteam</span>) <span class="op">&amp;</span> (<span class="kw">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="kw">pass</span> <span class="op">==</span> <span class="fl">1</span>))
<span class="kw">offense</span> <span class="op">&lt;-</span> <span class="kw">pbp</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span>(<span class="kw">posteam</span>) <span class="op">%&gt;%</span> <span class="fu">summarise</span>(off_epa = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">epa</span>, na.rm = <span class="fl">TRUE</span>))
<span class="kw">defense</span> <span class="op">&lt;-</span> <span class="kw">pbp</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span>(<span class="kw">defteam</span>) <span class="op">%&gt;%</span> <span class="fu">summarise</span>(def_epa = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">epa</span>, na.rm = <span class="fl">TRUE</span>))
<span class="kw">logos</span> <span class="op">&lt;-</span> <span class="kw">teams_colors_logos</span> <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">team_abbr</span>, <span class="kw">team_logo_espn</span>)

<span class="kw">offense</span> <span class="op">%&gt;%</span>
  <span class="fu">inner_join</span>(<span class="kw">defense</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"posteam"</span> = <span class="st">"defteam"</span>)) <span class="op">%&gt;%</span>
  <span class="fu">inner_join</span>(<span class="kw">logos</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"posteam"</span> = <span class="st">"team_abbr"</span>)) <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x = <span class="kw">off_epa</span>, y = <span class="kw">def_epa</span>)) <span class="op">+</span>
  <span class="fu">geom_abline</span>(slope = <span class="op">-</span><span class="fl">1.5</span>, intercept = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.4</span>, <span class="fl">.3</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="op">-</span><span class="fl">.2</span>, <span class="op">-</span><span class="fl">.3</span>), alpha = <span class="fl">.2</span>) <span class="op">+</span>
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(yintercept = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">off_epa</span>)), color = <span class="st">"red"</span>, linetype = <span class="st">"dashed"</span>) <span class="op">+</span>
  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(xintercept = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">def_epa</span>)), color = <span class="st">"red"</span>, linetype = <span class="st">"dashed"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggimage/man/geom_image.html">geom_image</a></span>(<span class="fu">aes</span>(image = <span class="kw">team_logo_espn</span>), size = <span class="fl">0.05</span>, asp = <span class="fl">16</span> <span class="op">/</span> <span class="fl">9</span>) <span class="op">+</span>
  <span class="fu">labs</span>(
    x = <span class="st">"Offense EPA/play"</span>,
    y = <span class="st">"Defense EPA/play"</span>,
    caption = <span class="st">"Data: @nflfastR"</span>,
    title = <span class="st">"2005 NFL Offensive and Defensive EPA per Play"</span>
  ) <span class="op">+</span>
  <span class="fu">theme_bw</span>() <span class="op">+</span>
  <span class="fu">theme</span>(
    aspect.ratio = <span class="fl">9</span> <span class="op">/</span> <span class="fl">16</span>,
    plot.title = <span class="fu">element_text</span>(size = <span class="fl">12</span>, hjust = <span class="fl">0.5</span>, face = <span class="st">"bold"</span>)
  ) <span class="op">+</span>
  <span class="fu">scale_y_reverse</span>()
</pre></div>
<p><img src="examples_files/figure-html/ex5-1.png" width="4375"></p>
</div>
<div id="example-6-expected-points-calculator" class="section level1">
<h1 class="hasAnchor">
<a href="#example-6-expected-points-calculator" class="anchor"></a>Example 6: Expected Points calculator</h1>
<p>We have provided a calculator for working with the Expected Points model. Here is an example of how to use it, looking for how the Expected Points on a drive beginning following a touchback has changed over time.</p>
<p>While I have put in <code>'SEA'</code> for <code>home_team</code> and <code>posteam</code>, this only matters for figuring out whether the team with the ball is the home team (there’s no actual effect for given team; it would be the same no matter what team is supplied).</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(
  <span class="st">"season"</span> = <span class="fl">1999</span><span class="op">:</span><span class="fl">2019</span>,
  <span class="st">"week"</span> = <span class="fl">5</span>,
  <span class="st">'home_team'</span> = <span class="st">'SEA'</span>,
  <span class="st">'posteam'</span> = <span class="st">'SEA'</span>,
  <span class="st">'roof'</span> = <span class="st">'outdoors'</span>,
  <span class="st">'half_seconds_remaining'</span> = <span class="fl">1800</span>,
  <span class="st">'yardline_100'</span> = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">80</span>, <span class="fl">17</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">75</span>, <span class="fl">4</span>)),
  <span class="st">'down'</span> = <span class="fl">1</span>,
  <span class="st">'ydstogo'</span> = <span class="fl">10</span>,
  <span class="st">'posteam_timeouts_remaining'</span> = <span class="fl">3</span>,
  <span class="st">'defteam_timeouts_remaining'</span> = <span class="fl">3</span>
)

<span class="kw">nflfastR</span>::<span class="fu"><a href="../reference/calculate_expected_points.html">calculate_expected_points</a></span>(<span class="kw">data</span>) <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">season</span>, <span class="kw">yardline_100</span>, <span class="kw">td_prob</span>, <span class="kw">ep</span>) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">2</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">yardline_100</th>
<th align="right">td_prob</th>
<th align="right">ep</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1999</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.59</td>
</tr>
<tr class="odd">
<td align="right">2001</td>
<td align="right">80</td>
<td align="right">0.33</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="right">2002</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.78</td>
</tr>
<tr class="odd">
<td align="right">2003</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.78</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.78</td>
</tr>
<tr class="odd">
<td align="right">2005</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.78</td>
</tr>
<tr class="even">
<td align="right">2006</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="right">2007</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="even">
<td align="right">2008</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="right">2009</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="right">2011</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="even">
<td align="right">2012</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="right">2013</td>
<td align="right">80</td>
<td align="right">0.34</td>
<td align="right">0.79</td>
</tr>
<tr class="even">
<td align="right">2014</td>
<td align="right">80</td>
<td align="right">0.35</td>
<td align="right">0.94</td>
</tr>
<tr class="odd">
<td align="right">2015</td>
<td align="right">80</td>
<td align="right">0.35</td>
<td align="right">0.94</td>
</tr>
<tr class="even">
<td align="right">2016</td>
<td align="right">75</td>
<td align="right">0.38</td>
<td align="right">1.37</td>
</tr>
<tr class="odd">
<td align="right">2017</td>
<td align="right">75</td>
<td align="right">0.38</td>
<td align="right">1.37</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="right">75</td>
<td align="right">0.40</td>
<td align="right">1.44</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="right">75</td>
<td align="right">0.40</td>
<td align="right">1.44</td>
</tr>
</tbody>
</table>
<p>Not surprisingly, offenses have become much more successful over time, with the kickoff touchback moving from the 20 to the 25 in 2016 providing an additional boost. Note that the <code>td_prob</code> in this example is the probability that the next score within the same half will be a touchdown scored by team with the ball, <strong>not</strong> the probability that the current drive will end in a touchdown (this is why the numbers are different from Example 4 above).</p>
<p>We could compare the most recent four years to the expectation for playing in a dome by inputting all the same things and changing the <code>roof</code> input:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(
  <span class="st">"season"</span> = <span class="fl">2016</span><span class="op">:</span><span class="fl">2019</span>,
  <span class="st">"week"</span> = <span class="fl">5</span>,
  <span class="st">'home_team'</span> = <span class="st">'SEA'</span>,
  <span class="st">'posteam'</span> = <span class="st">'SEA'</span>,
  <span class="st">'roof'</span> = <span class="st">'dome'</span>,
  <span class="st">'half_seconds_remaining'</span> = <span class="fl">1800</span>,
  <span class="st">'yardline_100'</span> = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">75</span>, <span class="fl">4</span>)),
  <span class="st">'down'</span> = <span class="fl">1</span>,
  <span class="st">'ydstogo'</span> = <span class="fl">10</span>,
  <span class="st">'posteam_timeouts_remaining'</span> = <span class="fl">3</span>,
  <span class="st">'defteam_timeouts_remaining'</span> = <span class="fl">3</span>
)

<span class="kw">nflfastR</span>::<span class="fu"><a href="../reference/calculate_expected_points.html">calculate_expected_points</a></span>(<span class="kw">data</span>) <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">season</span>, <span class="kw">yardline_100</span>, <span class="kw">td_prob</span>, <span class="kw">ep</span>) <span class="op">%&gt;%</span> 
  <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(digits = <span class="fl">2</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">season</th>
<th align="right">yardline_100</th>
<th align="right">td_prob</th>
<th align="right">ep</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2016</td>
<td align="right">75</td>
<td align="right">0.40</td>
<td align="right">1.56</td>
</tr>
<tr class="even">
<td align="right">2017</td>
<td align="right">75</td>
<td align="right">0.40</td>
<td align="right">1.56</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="right">75</td>
<td align="right">0.42</td>
<td align="right">1.67</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="right">75</td>
<td align="right">0.42</td>
<td align="right">1.67</td>
</tr>
</tbody>
</table>
<p>So for 2018 and 2019, 1st &amp; 10 from a home team’s own 25 yard line had EP of 1.44 outdoors and 1.67 in domes</p>
</div>
<div id="example-7-working-with-roster-and-position-data" class="section level1">
<h1 class="hasAnchor">
<a href="#example-7-working-with-roster-and-position-data" class="anchor"></a>Example 7: Working with roster and position data</h1>
<p>This section used to contain an example of working with roster data. Unfortunately, we have not found a way to obtain roster data that can be joined to the new play by play, so for now, it is empty. We would like to be able to get position data but haven’t yet.</p>
<p>The <code><a href="../reference/clean_pbp.html">clean_pbp()</a></code> function does a lot of work cleaning up player names and IDs for the purpose of joining them to roster data, but we do not have any roster data to join to. <strong>Note that player IDs are inconsistent between the old (1999-2010) and new (2011 - present) data sources so use IDs with caution</strong>. Unfortunately there is nothing we can do about this as the NFL changed their system for IDs in the underlying data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/mrcaseb">Sebastian Carl</a>, <a href="https://twitter.com/benbbaldwin">Ben Baldwin</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
